/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => CoalescePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian5 = require("obsidian");

// src/SettingsManager.ts
var DEFAULT_SETTINGS = {
  mySetting: "default",
  sortDescending: true,
  blocksCollapsed: true,
  showInDailyNotes: false,
  blockBoundaryStrategy: "default",
  theme: "default"
};
var SettingsManager = class {
  constructor(plugin) {
    this.plugin = plugin;
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.plugin.loadData());
  }
  async saveSettings() {
    await this.plugin.saveData(this.settings);
  }
};

// src/CoalesceManager.ts
var import_obsidian3 = require("obsidian");

// src/CoalesceView.ts
var import_obsidian2 = require("obsidian");

// src/BlockComponent.ts
var import_obsidian = require("obsidian");

// src/Logger.ts
var _Logger = class {
  static enable() {
    _Logger.enabled = true;
  }
  static disable() {
    _Logger.enabled = false;
  }
  info(message, ...optionalParams) {
    if (_Logger.enabled) {
      console.log(message, ...optionalParams);
    }
  }
  warn(message, ...optionalParams) {
    if (_Logger.enabled) {
      console.warn(message, ...optionalParams);
    }
  }
  debug(message, ...optionalParams) {
    if (_Logger.enabled) {
      console.debug(message, ...optionalParams);
    }
  }
};
var Logger = _Logger;
Logger.enabled = false;

// src/BlockComponent.ts
var BlockComponent = class {
  constructor(contents, filePath, noteName) {
    this.contents = contents;
    this.filePath = filePath;
    this.noteName = noteName;
    this.logger = new Logger();
  }
  async render(container, view, onLinkClick) {
    const displayText = this.filePath.replace(/\.md$/, "");
    const headerContainer = container.createDiv({ cls: "block-header" });
    this.toggleButton = headerContainer.createEl("span", {
      cls: "toggle-arrow",
      text: "\u25BC"
      // Down-pointing arrow for open state
    });
    const blockTitle = headerContainer.createEl("a", {
      text: displayText,
      cls: "block-title",
      href: "#"
    });
    blockTitle.addEventListener("click", (event) => {
      event.preventDefault();
      onLinkClick(this.filePath);
    });
    const blockContainer = container.createDiv({ cls: "backlink-item" });
    const contentPreview = blockContainer.createDiv("content-preview");
    await import_obsidian.MarkdownRenderer.render(
      view.app,
      this.contents,
      contentPreview,
      this.filePath,
      view
    );
    contentPreview.querySelectorAll("a.internal-link").forEach((link) => {
      link.addEventListener("click", (event) => {
        this.logger.info("Link clicked!");
        event.preventDefault();
        const href = link.getAttribute("href");
        if (href) {
          const decodedPath = decodeURI(href);
          const fullPath = decodedPath.endsWith(".canvas") ? decodedPath : decodedPath.endsWith(".md") ? decodedPath : `${decodedPath}.md`;
          onLinkClick(fullPath);
        }
      });
    });
    blockContainer.style.display = "block";
    this.toggleButton.addEventListener("click", () => {
      const isCollapsed = blockContainer.style.display === "none";
      blockContainer.style.display = isCollapsed ? "block" : "none";
      this.toggleButton.textContent = isCollapsed ? "\u25BC" : "\u25B6";
    });
    this.blockContainer = blockContainer;
  }
  getContainer() {
    return this.blockContainer;
  }
  setArrowState(isExpanded) {
    if (this.toggleButton) {
      this.toggleButton.textContent = isExpanded ? "\u25BC" : "\u25B6";
    }
  }
};

// src/HeaderComponent.ts
var HeaderComponent = class {
  createHeader(container, fileCount, blockCount, sortDescending, onSortToggle, onCollapseToggle, isCollapsed, currentStrategy, onStrategyChange, currentTheme, onThemeChange) {
    const header = document.createElement("div");
    header.classList.add("backlinks-header");
    const leftContainer = document.createElement("div");
    leftContainer.classList.add("backlinks-header-left");
    const rightContainer = document.createElement("div");
    rightContainer.classList.add("backlinks-header-right");
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("viewBox", "0 0 100 100");
    svg.setAttribute("width", "18");
    svg.setAttribute("height", "18");
    svg.setAttribute("fill", "currentColor");
    svg.innerHTML = `<path d="M85 40.5C85 22.5 70.5 10 52.5 10c-27.6 0-43.1 24.5-43.1 40 0 21.7 16.8 40 42.6 40 11.3 0 21.1-2.8 27.4-6.5 2.2-1.3 3.6-2.8 3.6-4.4 0-1.3-0.9-2.4-2.2-2.4-0.6 0-1.2 0.2-2 0.7-6.8 4.8-15.9 7.1-26.8 7.1-22.3 0-36.2-15.4-36.2-34.5 0-19.1 13.9-34.5 36.2-34.5 15.4 0 27.5 10.3 27.5 24.5 0 11.8-7.8 19.5-16.8 19.5-4.9 0-7.8-2.5-7.8-6.7 0-1.1 0.2-2.3 0.5-3.4l4.1-16.8c0.9-3.7-1.1-5.6-4-5.6-4.9 0-9.6 5-9.6 12.3 0 5.6 3.1 9.5 9.3 9.5 4.7 0 9.1-1.9 12.4-5.4 3.3 3.5 8.2 5.4 14.3 5.4C73.2 60 85 51.5 85 40.5z"/>`;
    leftContainer.appendChild(svg);
    const title = document.createElement("span");
    title.classList.add("header-title");
    title.textContent = `${fileCount} ${fileCount === 1 ? "Backlink" : "Backlinks"}, ${blockCount} ${blockCount === 1 ? "Block" : "Blocks"}`;
    leftContainer.appendChild(title);
    const sortButton = document.createElement("button");
    sortButton.classList.add("clickable-icon", "sort-button");
    sortButton.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 16 16" style="transform: ${sortDescending ? "none" : "rotate(180deg)"}">
                <path fill="currentColor" d="M4 4l4 4 4-4H4z"/>
            </svg>
        `;
    sortButton.addEventListener("click", onSortToggle);
    leftContainer.appendChild(sortButton);
    const collapseButton = document.createElement("button");
    collapseButton.classList.add("clickable-icon", "collapse-button");
    collapseButton.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 16 16" style="transform: ${isCollapsed ? "rotate(-90deg)" : "none"}">
                <path fill="currentColor" d="M4 4l4 4 4-4H4z"/>
            </svg>
        `;
    collapseButton.addEventListener("click", onCollapseToggle);
    leftContainer.appendChild(collapseButton);
    const blockBoundaryStrategySelect = document.createElement("select");
    blockBoundaryStrategySelect.classList.add("strategy-select");
    const blockBoundaryStrategies = ["default", "single-line"];
    blockBoundaryStrategies.forEach((strategy) => {
      const option = document.createElement("option");
      option.value = strategy;
      option.textContent = strategy.replace("-", " ").toUpperCase();
      option.selected = strategy === currentStrategy;
      blockBoundaryStrategySelect.appendChild(option);
    });
    blockBoundaryStrategySelect.addEventListener("change", () => {
      onStrategyChange(blockBoundaryStrategySelect.value);
    });
    leftContainer.appendChild(blockBoundaryStrategySelect);
    const themeSelect = document.createElement("select");
    themeSelect.classList.add("theme-select");
    const themes = ["default", "minimal", "modern"];
    themes.forEach((theme) => {
      const option = document.createElement("option");
      option.value = theme;
      option.textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
      option.selected = theme === currentTheme;
      themeSelect.appendChild(option);
    });
    themeSelect.addEventListener("change", () => {
      onThemeChange(themeSelect.value);
    });
    leftContainer.appendChild(themeSelect);
    const settingsButton = document.createElement("button");
    settingsButton.className = "settings-button";
    settingsButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        `;
    let popup = null;
    settingsButton.addEventListener("click", (e) => {
      e.stopPropagation();
      if (popup) {
        popup.remove();
        popup = null;
        return;
      }
      popup = document.createElement("div");
      popup.className = "settings-popup";
      const settingItem = document.createElement("div");
      settingItem.className = "settings-item";
      settingItem.textContent = "Placeholder Setting";
      popup.appendChild(settingItem);
      const rect = settingsButton.getBoundingClientRect();
      popup.style.top = `${rect.bottom + 5}px`;
      popup.style.left = `${rect.left}px`;
      document.body.appendChild(popup);
      const closePopup = (e2) => {
        if (popup && !popup.contains(e2.target) && e2.target !== settingsButton) {
          popup.remove();
          popup = null;
          document.removeEventListener("click", closePopup);
        }
      };
      document.addEventListener("click", closePopup);
    });
    leftContainer.appendChild(svg);
    leftContainer.appendChild(title);
    leftContainer.appendChild(sortButton);
    leftContainer.appendChild(collapseButton);
    leftContainer.appendChild(blockBoundaryStrategySelect);
    leftContainer.appendChild(themeSelect);
    rightContainer.appendChild(settingsButton);
    header.appendChild(leftContainer);
    header.appendChild(rightContainer);
    return header;
  }
};

// src/DefaultBlockBoundaryStrategy.ts
var DefaultBlockBoundaryStrategy = class {
  findBlockBoundaries(content, currentNoteName) {
    const boundaries = [];
    const regex = new RegExp(`\\[\\[${currentNoteName}\\]\\]`, "g");
    let match;
    while ((match = regex.exec(content)) !== null) {
      const lineStartIndex = content.lastIndexOf("\n", match.index) + 1;
      const endIndex = content.indexOf("---", match.index);
      const nextMentionIndex = content.indexOf(`[[${currentNoteName}]]`, match.index + 1);
      let blockEndIndex = content.length;
      if (endIndex !== -1 && (nextMentionIndex === -1 || endIndex < nextMentionIndex)) {
        blockEndIndex = endIndex;
      } else if (nextMentionIndex !== -1) {
        blockEndIndex = nextMentionIndex;
      }
      boundaries.push({ start: lineStartIndex, end: blockEndIndex });
    }
    return boundaries;
  }
};

// src/SingleLineBlockBoundaryStrategy.ts
var SingleLineBlockBoundaryStrategy = class {
  findBlockBoundaries(content, currentNoteName) {
    const boundaries = [];
    const lines = content.split("\n");
    if (lines.length > 0) {
      const firstLine = lines[0];
      boundaries.push({ start: 0, end: firstLine.length });
    }
    return boundaries;
  }
};

// src/CoalesceView.ts
var CoalesceView = class {
  constructor(view, currentNoteName, settingsManager, blockBoundaryStrategy) {
    this.view = view;
    this.settingsManager = settingsManager;
    this.logger = new Logger();
    this.headerComponent = new HeaderComponent();
    this.allBlocks = [];
    this.currentNoteName = currentNoteName;
    this.blockBoundaryStrategy = blockBoundaryStrategy;
    this.sortDescending = this.settingsManager.settings.sortDescending;
    this.blocksCollapsed = this.settingsManager.settings.blocksCollapsed;
    this.container = this.createBacklinksContainer();
    this.logger.info("Appending backlinks container to the view");
    this.currentTheme = this.settingsManager.settings.theme;
    this.applyTheme(this.currentTheme);
    const markdownContent = this.view.containerEl.querySelector(".markdown-preview-view") || this.view.contentEl;
    if (markdownContent) {
      markdownContent.classList.add("markdown-content");
      markdownContent.appendChild(this.container);
    } else {
      this.logger.warn("Markdown content area not found.");
    }
  }
  createBacklinksContainer() {
    const container = document.createElement("div");
    container.classList.add("custom-backlinks-container");
    return container;
  }
  async getBlockData(filePath, currentNoteName) {
    const blocks = [];
    try {
      const file = this.view.app.vault.getAbstractFileByPath(filePath);
      if (file && file instanceof import_obsidian2.TFile) {
        const content = await this.view.app.vault.read(file);
        const boundaries = this.blockBoundaryStrategy.findBlockBoundaries(content, currentNoteName);
        for (const { start, end } of boundaries) {
          const blockContent = content.substring(start, end);
          const block = new BlockComponent(blockContent, filePath, currentNoteName);
          blocks.push(block);
        }
      }
    } catch (error) {
      console.error(`Error reading file content for ${filePath}:`, error);
    }
    return blocks;
  }
  updateBlockBoundaryStrategy(strategy) {
    switch (strategy) {
      case "single-line":
        this.blockBoundaryStrategy = new SingleLineBlockBoundaryStrategy();
        break;
      case "default":
      default:
        this.blockBoundaryStrategy = new DefaultBlockBoundaryStrategy();
        break;
    }
  }
  applyTheme(theme) {
    const themes = ["default", "minimal", "modern"];
    themes.forEach((t) => {
      this.container.classList.remove(`theme-${t}`);
    });
    this.container.classList.add(`theme-${theme}`);
  }
  async handleThemeChange(theme) {
    this.currentTheme = theme;
    this.settingsManager.settings.theme = theme;
    await this.settingsManager.saveSettings();
    this.applyTheme(theme);
  }
  async updateBacklinks(filesLinkingToThis, onLinkClick) {
    this.logger.info("Updating backlinks:", filesLinkingToThis);
    this.container.empty();
    const linksContainer = this.container.createDiv("backlinks-list");
    this.logger.info("Links container:", linksContainer);
    this.allBlocks = [];
    for (const sourcePath of filesLinkingToThis) {
      const blocks = await this.getBlockData(sourcePath, this.currentNoteName);
      blocks.forEach((block) => {
        this.allBlocks.push({ block, sourcePath });
      });
    }
    this.allBlocks.sort((a, b) => this.sortDescending ? b.sourcePath.localeCompare(a.sourcePath) : a.sourcePath.localeCompare(b.sourcePath));
    for (const { block } of this.allBlocks) {
      await block.render(linksContainer, this.view, onLinkClick);
      const blockContainer = block.getContainer();
      blockContainer.style.display = this.blocksCollapsed ? "none" : "block";
      block.setArrowState(!this.blocksCollapsed);
    }
    const createHeader = () => {
      return this.headerComponent.createHeader(
        this.container,
        filesLinkingToThis.length,
        this.allBlocks.length,
        this.sortDescending,
        () => {
          this.toggleSort();
          this.updateBacklinks(filesLinkingToThis, onLinkClick);
        },
        () => {
          this.toggleAllBlocks();
          const oldHeader = this.container.querySelector(".backlinks-header");
          if (oldHeader && this.container.contains(oldHeader)) {
            const newHeader = createHeader();
            this.container.replaceChild(newHeader, oldHeader);
          }
        },
        this.blocksCollapsed,
        this.settingsManager.settings.blockBoundaryStrategy,
        async (strategy) => {
          this.settingsManager.settings.blockBoundaryStrategy = strategy;
          await this.settingsManager.saveSettings();
          this.updateBlockBoundaryStrategy(strategy);
          await this.updateBacklinks(filesLinkingToThis, onLinkClick);
        },
        this.currentTheme,
        async (theme) => {
          await this.handleThemeChange(theme);
        }
      );
    };
    const header = createHeader();
    this.container.appendChild(header);
    this.container.appendChild(linksContainer);
  }
  toggleSort() {
    this.sortDescending = !this.sortDescending;
    this.settingsManager.settings.sortDescending = this.sortDescending;
    this.settingsManager.saveSettings();
  }
  toggleAllBlocks() {
    this.blocksCollapsed = !this.blocksCollapsed;
    this.settingsManager.settings.blocksCollapsed = this.blocksCollapsed;
    this.settingsManager.saveSettings();
    this.allBlocks.forEach(({ block }) => {
      const blockContainer = block.getContainer();
      blockContainer.style.display = this.blocksCollapsed ? "none" : "block";
      block.setArrowState(!this.blocksCollapsed);
    });
  }
  clear() {
    if (this.container.parentElement) {
      this.container.parentElement.removeChild(this.container);
    }
    this.logger.info("Backlinks view cleared");
  }
};

// src/CoalesceManager.ts
var CoalesceManager = class {
  constructor(app, settingsManager) {
    this.app = app;
    this.settingsManager = settingsManager;
    this.coalesceView = null;
    this.logger = new Logger();
  }
  handleFileOpen(file) {
    if (!file)
      return;
    const view = this.app.workspace.getActiveViewOfType(import_obsidian3.MarkdownView);
    if (!view)
      return;
    if (this.coalesceView) {
      this.coalesceView.clear();
    }
    const currentNoteName = file.basename;
    const blockBoundaryStrategy = this.getStrategyFromSettings();
    this.coalesceView = new CoalesceView(view, currentNoteName, this.settingsManager, blockBoundaryStrategy);
    const backlinks = this.app.metadataCache.resolvedLinks;
    const filesLinkingToThis = Object.entries(backlinks).filter(([_, links]) => file.path in links).map(([sourcePath]) => sourcePath);
    this.coalesceView.updateBacklinks(filesLinkingToThis, (path) => {
      this.app.workspace.openLinkText(path, "", false);
    });
  }
  getStrategyFromSettings() {
    const blockBoundaryStrategy = this.settingsManager.settings.blockBoundaryStrategy;
    switch (blockBoundaryStrategy) {
      case "single-line":
        return new SingleLineBlockBoundaryStrategy();
      case "default":
      default:
        return new DefaultBlockBoundaryStrategy();
    }
  }
  clearBacklinks() {
    if (this.coalesceView) {
      this.coalesceView.clear();
    }
  }
};

// src/SettingsTab.ts
var import_obsidian4 = require("obsidian");
var CoalesceSettingTab = class extends import_obsidian4.PluginSettingTab {
  constructor(app, plugin, settingsManager) {
    super(app, plugin);
    this.plugin = plugin;
    this.settingsManager = settingsManager;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian4.Setting(containerEl).setName("Show in Daily Notes").setDesc("Enable Coalesce view in daily notes").addToggle((toggle) => toggle.setValue(this.settingsManager.settings.showInDailyNotes).onChange(async (value) => {
      this.settingsManager.settings.showInDailyNotes = value;
      await this.settingsManager.saveSettings();
    }));
  }
};

// main.ts
var CoalescePlugin = class extends import_obsidian5.Plugin {
  async onload() {
    this.logger = new Logger();
    this.settingsManager = new SettingsManager(this);
    await this.settingsManager.loadSettings();
    this.addSettingTab(new CoalesceSettingTab(this.app, this, this.settingsManager));
    this.coalesceManager = new CoalesceManager(this.app, this.settingsManager);
    this.app.workspace.on("file-open", (file) => {
      if (!file)
        return;
      const isDaily = this.isDailyNote(file);
      if (!isDaily || isDaily && this.settingsManager.settings.showInDailyNotes) {
        this.coalesceManager.handleFileOpen(file);
      } else {
        this.coalesceManager.clearBacklinks();
      }
    });
    window.enableLogging = function() {
      Logger.enable();
      console.log("Logging enabled");
    };
    window.disableLogging = function() {
      Logger.disable();
      console.log("Logging disabled");
    };
  }
  onunload() {
    this.coalesceManager.clearBacklinks();
  }
  isDailyNote(file) {
    const dailyNotesPlugin = this.app.internalPlugins.plugins["daily-notes"];
    if (!dailyNotesPlugin || !dailyNotesPlugin.enabled) {
      this.logger.debug("Daily Notes plugin is not enabled.");
      return false;
    }
    const dailyNotesFolder = dailyNotesPlugin.instance.options.folder || "";
    if (!dailyNotesFolder) {
      this.logger.debug("Daily Notes folder not set, using vault root.");
    }
    const dailyNotePattern = /^\d{4}-\d{2}-\d{2}\.md$/;
    if (!file.path.startsWith(dailyNotesFolder)) {
      return false;
    }
    return dailyNotePattern.test(file.name);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvU2V0dGluZ3NNYW5hZ2VyLnRzIiwgInNyYy9Db2FsZXNjZU1hbmFnZXIudHMiLCAic3JjL0NvYWxlc2NlVmlldy50cyIsICJzcmMvQmxvY2tDb21wb25lbnQudHMiLCAic3JjL0xvZ2dlci50cyIsICJzcmMvSGVhZGVyQ29tcG9uZW50LnRzIiwgInNyYy9EZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5LnRzIiwgInNyYy9TaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5LnRzIiwgInNyYy9TZXR0aW5nc1RhYi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSAnLi9zcmMvU2V0dGluZ3NNYW5hZ2VyJztcbmltcG9ydCB7IENvYWxlc2NlTWFuYWdlciB9IGZyb20gJy4vc3JjL0NvYWxlc2NlTWFuYWdlcic7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuL3NyYy9Mb2dnZXInO1xuaW1wb3J0IHsgQ29hbGVzY2VTZXR0aW5nVGFiIH0gZnJvbSAnLi9zcmMvU2V0dGluZ3NUYWInO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb2FsZXNjZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdHByaXZhdGUgc2V0dGluZ3NNYW5hZ2VyOiBTZXR0aW5nc01hbmFnZXI7XG5cdHByaXZhdGUgY29hbGVzY2VNYW5hZ2VyOiBDb2FsZXNjZU1hbmFnZXI7XG5cdHByaXZhdGUgbG9nZ2VyOiBMb2dnZXI7XG5cblx0YXN5bmMgb25sb2FkKCkge1xuXHRcdHRoaXMubG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXHRcdHRoaXMuc2V0dGluZ3NNYW5hZ2VyID0gbmV3IFNldHRpbmdzTWFuYWdlcih0aGlzKTtcblx0XHRhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5sb2FkU2V0dGluZ3MoKTtcblxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgQ29hbGVzY2VTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzLCB0aGlzLnNldHRpbmdzTWFuYWdlcikpO1xuXG5cdFx0dGhpcy5jb2FsZXNjZU1hbmFnZXIgPSBuZXcgQ29hbGVzY2VNYW5hZ2VyKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzTWFuYWdlcik7XG5cdFx0dGhpcy5hcHAud29ya3NwYWNlLm9uKCdmaWxlLW9wZW4nLCAoZmlsZTogVEZpbGUpID0+IHtcblx0XHRcdGlmICghZmlsZSkgcmV0dXJuO1xuXHRcdFx0XG5cdFx0XHRjb25zdCBpc0RhaWx5ID0gdGhpcy5pc0RhaWx5Tm90ZShmaWxlKTtcblx0XHRcdGlmICghaXNEYWlseSB8fCAoaXNEYWlseSAmJiB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5zaG93SW5EYWlseU5vdGVzKSkge1xuXHRcdFx0XHR0aGlzLmNvYWxlc2NlTWFuYWdlci5oYW5kbGVGaWxlT3BlbihmaWxlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29hbGVzY2VNYW5hZ2VyLmNsZWFyQmFja2xpbmtzKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBMb2dnaW5nXG5cdFx0ICogVXNhZ2U6IEluIHRoZSBicm93c2VyIGNvbnNvbGUsIHR5cGUgYGVuYWJsZUxvZ2dpbmcoKWAgdG8gZW5hYmxlIGxvZ2dpbmcuXG5cdFx0ICogVXNhZ2U6IEluIHRoZSBicm93c2VyIGNvbnNvbGUsIHR5cGUgYGRpc2FibGVMb2dnaW5nKClgIHRvIGRpc2FibGUgbG9nZ2luZy5cblx0XHQgKi9cblx0XHRcblx0XHQod2luZG93IGFzIGFueSkuZW5hYmxlTG9nZ2luZyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0TG9nZ2VyLmVuYWJsZSgpO1xuXHRcdFx0Y29uc29sZS5sb2coXCJMb2dnaW5nIGVuYWJsZWRcIik7XG5cdFx0fTtcblx0XHQod2luZG93IGFzIGFueSkuZGlzYWJsZUxvZ2dpbmcgPSBmdW5jdGlvbigpIHtcblx0XHRcdExvZ2dlci5kaXNhYmxlKCk7XG5cdFx0XHRjb25zb2xlLmxvZyhcIkxvZ2dpbmcgZGlzYWJsZWRcIik7XG5cdFx0fTtcblx0fVxuXG5cdG9udW5sb2FkKCkge1xuXHRcdHRoaXMuY29hbGVzY2VNYW5hZ2VyLmNsZWFyQmFja2xpbmtzKCk7XG5cdH1cblxuXHRwcml2YXRlIGlzRGFpbHlOb3RlKGZpbGU6IFRGaWxlKTogYm9vbGVhbiB7XG5cdFx0Ly8gQWNjZXNzIHRoZSBEYWlseSBOb3RlcyBjb3JlIHBsdWdpblxuXHRcdGNvbnN0IGRhaWx5Tm90ZXNQbHVnaW4gPSAodGhpcy5hcHAgYXMgYW55KS5pbnRlcm5hbFBsdWdpbnMucGx1Z2luc1snZGFpbHktbm90ZXMnXTtcblx0XHRpZiAoIWRhaWx5Tm90ZXNQbHVnaW4gfHwgIWRhaWx5Tm90ZXNQbHVnaW4uZW5hYmxlZCkge1xuXHRcdFx0dGhpcy5sb2dnZXIuZGVidWcoJ0RhaWx5IE5vdGVzIHBsdWdpbiBpcyBub3QgZW5hYmxlZC4nKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBSZXRyaWV2ZSB0aGUgZGFpbHkgbm90ZXMgZm9sZGVyIGZyb20gdGhlIHBsdWdpbidzIHNldHRpbmdzXG5cdFx0Y29uc3QgZGFpbHlOb3Rlc0ZvbGRlciA9IGRhaWx5Tm90ZXNQbHVnaW4uaW5zdGFuY2Uub3B0aW9ucy5mb2xkZXIgfHwgJyc7XG5cdFx0aWYgKCFkYWlseU5vdGVzRm9sZGVyKSB7XG5cdFx0XHR0aGlzLmxvZ2dlci5kZWJ1ZyhcIkRhaWx5IE5vdGVzIGZvbGRlciBub3Qgc2V0LCB1c2luZyB2YXVsdCByb290LlwiKTtcblx0XHR9XG5cblx0XHRjb25zdCBkYWlseU5vdGVQYXR0ZXJuID0gL15cXGR7NH0tXFxkezJ9LVxcZHsyfVxcLm1kJC87IC8vIEFkanVzdCB0aGlzIHBhdHRlcm4gaWYgbmVlZGVkXG5cblx0XHQvLyBDaGVjayBpZiB0aGUgZmlsZSBpcyBpbiB0aGUgZGFpbHkgbm90ZXMgZm9sZGVyXG5cdFx0aWYgKCFmaWxlLnBhdGguc3RhcnRzV2l0aChkYWlseU5vdGVzRm9sZGVyKSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIENoZWNrIGlmIHRoZSBmaWxlIG5hbWUgbWF0Y2hlcyB0aGUgZGFpbHkgbm90ZSBwYXR0ZXJuXG5cdFx0cmV0dXJuIGRhaWx5Tm90ZVBhdHRlcm4udGVzdChmaWxlLm5hbWUpO1xuXHR9XG59IiwgImludGVyZmFjZSBDb2FsZXNjZVBsdWdpblNldHRpbmdzIHtcbiAgICBteVNldHRpbmc6IHN0cmluZztcbiAgICBzb3J0RGVzY2VuZGluZzogYm9vbGVhbjtcbiAgICBibG9ja3NDb2xsYXBzZWQ6IGJvb2xlYW47XG4gICAgc2hvd0luRGFpbHlOb3RlczogYm9vbGVhbjtcbiAgICBibG9ja0JvdW5kYXJ5U3RyYXRlZ3k6IHN0cmluZztcbiAgICB0aGVtZTogc3RyaW5nO1xufVxuXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBDb2FsZXNjZVBsdWdpblNldHRpbmdzID0ge1xuICAgIG15U2V0dGluZzogJ2RlZmF1bHQnLFxuICAgIHNvcnREZXNjZW5kaW5nOiB0cnVlLFxuICAgIGJsb2Nrc0NvbGxhcHNlZDogdHJ1ZSxcbiAgICBzaG93SW5EYWlseU5vdGVzOiBmYWxzZSxcbiAgICBibG9ja0JvdW5kYXJ5U3RyYXRlZ3k6ICdkZWZhdWx0JyxcbiAgICB0aGVtZTogJ2RlZmF1bHQnXG59O1xuXG5pbnRlcmZhY2UgUGx1Z2luIHtcbiAgICBsb2FkRGF0YSgpOiBQcm9taXNlPFBhcnRpYWw8Q29hbGVzY2VQbHVnaW5TZXR0aW5ncz4+O1xuICAgIHNhdmVEYXRhKHNldHRpbmdzOiBDb2FsZXNjZVBsdWdpblNldHRpbmdzKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuY2xhc3MgUGx1Z2luIHtcbiAgICBhc3luYyBsb2FkRGF0YSgpOiBQcm9taXNlPFBhcnRpYWw8Q29hbGVzY2VQbHVnaW5TZXR0aW5ncz4+IHtcbiAgICAgICAgcmV0dXJuIHt9O1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVEYXRhKHNldHRpbmdzOiBDb2FsZXNjZVBsdWdpblNldHRpbmdzKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgU2V0dGluZ3NNYW5hZ2VyIHtcbiAgICBwcml2YXRlIHBsdWdpbjogUGx1Z2luO1xuICAgIHNldHRpbmdzOiBDb2FsZXNjZVBsdWdpblNldHRpbmdzO1xuXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBQbHVnaW4pIHtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5wbHVnaW4ubG9hZERhdGEoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNYXJrZG93blZpZXcsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgQ29hbGVzY2VWaWV3IH0gZnJvbSAnLi9Db2FsZXNjZVZpZXcnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi9Mb2dnZXInO1xuaW1wb3J0IHsgU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSAnLi9TZXR0aW5nc01hbmFnZXInO1xuaW1wb3J0IHsgRGVmYXVsdEJsb2NrQm91bmRhcnlTdHJhdGVneSB9IGZyb20gJy4vRGVmYXVsdEJsb2NrQm91bmRhcnlTdHJhdGVneSc7XG5pbXBvcnQgeyBTaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5IH0gZnJvbSAnLi9TaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5JztcblxuZXhwb3J0IGNsYXNzIENvYWxlc2NlTWFuYWdlciB7XG4gICAgcHJpdmF0ZSBjb2FsZXNjZVZpZXc6IENvYWxlc2NlVmlldyB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgbG9nZ2VyOiBMb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwcDogQXBwLCBwcml2YXRlIHNldHRpbmdzTWFuYWdlcjogU2V0dGluZ3NNYW5hZ2VyKSB7fVxuXG4gICAgaGFuZGxlRmlsZU9wZW4oZmlsZTogVEZpbGUpIHtcbiAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICAgIGlmICghdmlldykgcmV0dXJuO1xuXG4gICAgICAgIGlmICh0aGlzLmNvYWxlc2NlVmlldykge1xuICAgICAgICAgICAgdGhpcy5jb2FsZXNjZVZpZXcuY2xlYXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnROb3RlTmFtZSA9IGZpbGUuYmFzZW5hbWU7XG4gICAgICAgIGNvbnN0IGJsb2NrQm91bmRhcnlTdHJhdGVneSA9IHRoaXMuZ2V0U3RyYXRlZ3lGcm9tU2V0dGluZ3MoKTtcbiAgICAgICAgdGhpcy5jb2FsZXNjZVZpZXcgPSBuZXcgQ29hbGVzY2VWaWV3KHZpZXcsIGN1cnJlbnROb3RlTmFtZSwgdGhpcy5zZXR0aW5nc01hbmFnZXIsIGJsb2NrQm91bmRhcnlTdHJhdGVneSk7XG5cbiAgICAgICAgY29uc3QgYmFja2xpbmtzID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5yZXNvbHZlZExpbmtzO1xuICAgICAgICBjb25zdCBmaWxlc0xpbmtpbmdUb1RoaXMgPSBPYmplY3QuZW50cmllcyhiYWNrbGlua3MpXG4gICAgICAgICAgICAuZmlsdGVyKChbXywgbGlua3NdKSA9PiBmaWxlLnBhdGggaW4gKGxpbmtzIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KSlcbiAgICAgICAgICAgIC5tYXAoKFtzb3VyY2VQYXRoXSkgPT4gc291cmNlUGF0aCk7XG5cbiAgICAgICAgdGhpcy5jb2FsZXNjZVZpZXcudXBkYXRlQmFja2xpbmtzKGZpbGVzTGlua2luZ1RvVGhpcywgKHBhdGgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQocGF0aCwgJycsIGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRTdHJhdGVneUZyb21TZXR0aW5ncygpIHtcbiAgICAgICAgY29uc3QgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5ID0gdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0dGluZ3MuYmxvY2tCb3VuZGFyeVN0cmF0ZWd5O1xuICAgICAgICBzd2l0Y2ggKGJsb2NrQm91bmRhcnlTdHJhdGVneSkge1xuICAgICAgICAgICAgY2FzZSAnc2luZ2xlLWxpbmUnOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2luZ2xlTGluZUJsb2NrQm91bmRhcnlTdHJhdGVneSgpO1xuICAgICAgICAgICAgY2FzZSAnZGVmYXVsdCc6XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGVmYXVsdEJsb2NrQm91bmRhcnlTdHJhdGVneSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xlYXJCYWNrbGlua3MoKSB7XG4gICAgICAgIGlmICh0aGlzLmNvYWxlc2NlVmlldykge1xuICAgICAgICAgICAgdGhpcy5jb2FsZXNjZVZpZXcuY2xlYXIoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBNYXJrZG93blZpZXcsIFRGaWxlLCBNYXJrZG93blJlbmRlcmVyIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgQmxvY2tDb21wb25lbnQgfSBmcm9tICcuL0Jsb2NrQ29tcG9uZW50JztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vTG9nZ2VyJztcbmltcG9ydCB7IEhlYWRlckNvbXBvbmVudCB9IGZyb20gJy4vSGVhZGVyQ29tcG9uZW50JztcbmltcG9ydCB7IFNldHRpbmdzTWFuYWdlciB9IGZyb20gJy4vU2V0dGluZ3NNYW5hZ2VyJztcbmltcG9ydCB7IEJsb2NrQm91bmRhcnlTdHJhdGVneSB9IGZyb20gJy4vQmxvY2tCb3VuZGFyeVN0cmF0ZWd5JztcbmltcG9ydCB7IERlZmF1bHRCbG9ja0JvdW5kYXJ5U3RyYXRlZ3kgfSBmcm9tICcuL0RlZmF1bHRCbG9ja0JvdW5kYXJ5U3RyYXRlZ3knO1xuaW1wb3J0IHsgU2luZ2xlTGluZUJsb2NrQm91bmRhcnlTdHJhdGVneSB9IGZyb20gJy4vU2luZ2xlTGluZUJsb2NrQm91bmRhcnlTdHJhdGVneSc7XG5cbmV4cG9ydCBjbGFzcyBDb2FsZXNjZVZpZXcge1xuICAgIHByaXZhdGUgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgICBwcml2YXRlIGN1cnJlbnROb3RlTmFtZTogc3RyaW5nO1xuICAgIHByaXZhdGUgbG9nZ2VyOiBMb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG4gICAgcHJpdmF0ZSBoZWFkZXJDb21wb25lbnQ6IEhlYWRlckNvbXBvbmVudCA9IG5ldyBIZWFkZXJDb21wb25lbnQoKTtcbiAgICBwcml2YXRlIHNvcnREZXNjZW5kaW5nOiBib29sZWFuO1xuICAgIHByaXZhdGUgYmxvY2tzQ29sbGFwc2VkOiBib29sZWFuO1xuICAgIHByaXZhdGUgYWxsQmxvY2tzOiB7IGJsb2NrOiBCbG9ja0NvbXBvbmVudDsgc291cmNlUGF0aDogc3RyaW5nIH1bXSA9IFtdO1xuICAgIHByaXZhdGUgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5OiBCbG9ja0JvdW5kYXJ5U3RyYXRlZ3k7XG4gICAgcHJpdmF0ZSBjdXJyZW50VGhlbWU6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHZpZXc6IE1hcmtkb3duVmlldyxcbiAgICAgICAgY3VycmVudE5vdGVOYW1lOiBzdHJpbmcsXG4gICAgICAgIHByaXZhdGUgc2V0dGluZ3NNYW5hZ2VyOiBTZXR0aW5nc01hbmFnZXIsXG4gICAgICAgIGJsb2NrQm91bmRhcnlTdHJhdGVneTogQmxvY2tCb3VuZGFyeVN0cmF0ZWd5LFxuICAgICkge1xuICAgICAgICB0aGlzLmN1cnJlbnROb3RlTmFtZSA9IGN1cnJlbnROb3RlTmFtZTtcbiAgICAgICAgdGhpcy5ibG9ja0JvdW5kYXJ5U3RyYXRlZ3kgPSBibG9ja0JvdW5kYXJ5U3RyYXRlZ3k7XG4gICAgICAgIHRoaXMuc29ydERlc2NlbmRpbmcgPSB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5zb3J0RGVzY2VuZGluZztcbiAgICAgICAgdGhpcy5ibG9ja3NDb2xsYXBzZWQgPSB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5ibG9ja3NDb2xsYXBzZWQ7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5jcmVhdGVCYWNrbGlua3NDb250YWluZXIoKTtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkFwcGVuZGluZyBiYWNrbGlua3MgY29udGFpbmVyIHRvIHRoZSB2aWV3XCIpO1xuXG4gICAgICAgIHRoaXMuY3VycmVudFRoZW1lID0gdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0dGluZ3MudGhlbWU7XG4gICAgICAgIHRoaXMuYXBwbHlUaGVtZSh0aGlzLmN1cnJlbnRUaGVtZSk7XG5cbiAgICAgICAgLy8gQXBwZW5kIHRoZSBjb250YWluZXIgZGlyZWN0bHkgdG8gdGhlIG1hcmtkb3duIHZpZXcncyBjb250ZW50IGFyZWFcbiAgICAgICAgY29uc3QgbWFya2Rvd25Db250ZW50ID0gdGhpcy52aWV3LmNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3IoJy5tYXJrZG93bi1wcmV2aWV3LXZpZXcnKSBhcyBIVE1MRWxlbWVudCB8fCB0aGlzLnZpZXcuY29udGVudEVsIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBpZiAobWFya2Rvd25Db250ZW50KSB7XG4gICAgICAgICAgICBtYXJrZG93bkNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnbWFya2Rvd24tY29udGVudCcpO1xuICAgICAgICAgICAgbWFya2Rvd25Db250ZW50LmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVyKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybihcIk1hcmtkb3duIGNvbnRlbnQgYXJlYSBub3QgZm91bmQuXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVCYWNrbGlua3NDb250YWluZXIoKTogSFRNTEVsZW1lbnQge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2N1c3RvbS1iYWNrbGlua3MtY29udGFpbmVyJyk7XG4gICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBnZXRCbG9ja0RhdGEoZmlsZVBhdGg6IHN0cmluZywgY3VycmVudE5vdGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPEJsb2NrQ29tcG9uZW50W10+IHtcbiAgICAgICAgY29uc3QgYmxvY2tzOiBCbG9ja0NvbXBvbmVudFtdID0gW107XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMudmlldy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGZpbGUgJiYgZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMudmlldy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBib3VuZGFyaWVzID0gdGhpcy5ibG9ja0JvdW5kYXJ5U3RyYXRlZ3kuZmluZEJsb2NrQm91bmRhcmllcyhjb250ZW50LCBjdXJyZW50Tm90ZU5hbWUpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB7IHN0YXJ0LCBlbmQgfSBvZiBib3VuZGFyaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2NrQ29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9jayA9IG5ldyBCbG9ja0NvbXBvbmVudChibG9ja0NvbnRlbnQsIGZpbGVQYXRoLCBjdXJyZW50Tm90ZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBibG9ja3MucHVzaChibG9jayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgcmVhZGluZyBmaWxlIGNvbnRlbnQgZm9yICR7ZmlsZVBhdGh9OmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmxvY2tzO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlQmxvY2tCb3VuZGFyeVN0cmF0ZWd5KHN0cmF0ZWd5OiBzdHJpbmcpIHtcbiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkge1xuICAgICAgICAgICAgY2FzZSAnc2luZ2xlLWxpbmUnOlxuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tCb3VuZGFyeVN0cmF0ZWd5ID0gbmV3IFNpbmdsZUxpbmVCbG9ja0JvdW5kYXJ5U3RyYXRlZ3koKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2RlZmF1bHQnOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrQm91bmRhcnlTdHJhdGVneSA9IG5ldyBEZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFwcGx5VGhlbWUodGhlbWU6IHN0cmluZykge1xuICAgICAgICBjb25zdCB0aGVtZXMgPSBbJ2RlZmF1bHQnLCAnbWluaW1hbCcsICdtb2Rlcm4nXTtcbiAgICAgICAgdGhlbWVzLmZvckVhY2godCA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKGB0aGVtZS0ke3R9YCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGB0aGVtZS0ke3RoZW1lfWApO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgaGFuZGxlVGhlbWVDaGFuZ2UodGhlbWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLmN1cnJlbnRUaGVtZSA9IHRoZW1lO1xuICAgICAgICB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy50aGVtZSA9IHRoZW1lO1xuICAgICAgICBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgdGhpcy5hcHBseVRoZW1lKHRoZW1lKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgdXBkYXRlQmFja2xpbmtzKGZpbGVzTGlua2luZ1RvVGhpczogc3RyaW5nW10sIG9uTGlua0NsaWNrOiAocGF0aDogc3RyaW5nKSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJVcGRhdGluZyBiYWNrbGlua3M6XCIsIGZpbGVzTGlua2luZ1RvVGhpcyk7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmVtcHR5KCk7XG5cbiAgICAgICAgY29uc3QgbGlua3NDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lci5jcmVhdGVEaXYoJ2JhY2tsaW5rcy1saXN0Jyk7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJMaW5rcyBjb250YWluZXI6XCIsIGxpbmtzQ29udGFpbmVyKTtcblxuICAgICAgICB0aGlzLmFsbEJsb2NrcyA9IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gQ29sbGVjdCBhbGwgYmxvY2tzIGZpcnN0XG4gICAgICAgIGZvciAoY29uc3Qgc291cmNlUGF0aCBvZiBmaWxlc0xpbmtpbmdUb1RoaXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2NrcyA9IGF3YWl0IHRoaXMuZ2V0QmxvY2tEYXRhKHNvdXJjZVBhdGgsIHRoaXMuY3VycmVudE5vdGVOYW1lKTtcbiAgICAgICAgICAgIGJsb2Nrcy5mb3JFYWNoKGJsb2NrID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFsbEJsb2Nrcy5wdXNoKHsgYmxvY2ssIHNvdXJjZVBhdGggfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNvcnQgYmxvY2tzXG4gICAgICAgIHRoaXMuYWxsQmxvY2tzLnNvcnQoKGEsIGIpID0+IHRoaXMuc29ydERlc2NlbmRpbmcgXG4gICAgICAgICAgICA/IGIuc291cmNlUGF0aC5sb2NhbGVDb21wYXJlKGEuc291cmNlUGF0aClcbiAgICAgICAgICAgIDogYS5zb3VyY2VQYXRoLmxvY2FsZUNvbXBhcmUoYi5zb3VyY2VQYXRoKSk7XG5cbiAgICAgICAgLy8gUmVuZGVyIGJsb2NrcyB3aXRoIGNvcnJlY3QgaW5pdGlhbCBzdGF0ZVxuICAgICAgICBmb3IgKGNvbnN0IHsgYmxvY2sgfSBvZiB0aGlzLmFsbEJsb2Nrcykge1xuICAgICAgICAgICAgYXdhaXQgYmxvY2sucmVuZGVyKGxpbmtzQ29udGFpbmVyLCB0aGlzLnZpZXcsIG9uTGlua0NsaWNrKTtcbiAgICAgICAgICAgIGNvbnN0IGJsb2NrQ29udGFpbmVyID0gYmxvY2suZ2V0Q29udGFpbmVyKCk7XG4gICAgICAgICAgICBibG9ja0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gdGhpcy5ibG9ja3NDb2xsYXBzZWQgPyAnbm9uZScgOiAnYmxvY2snO1xuICAgICAgICAgICAgYmxvY2suc2V0QXJyb3dTdGF0ZSghdGhpcy5ibG9ja3NDb2xsYXBzZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIGhlYWRlciBhZnRlciBibG9ja3MgYXJlIHJlbmRlcmVkXG4gICAgICAgIGNvbnN0IGNyZWF0ZUhlYWRlciA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhlYWRlckNvbXBvbmVudC5jcmVhdGVIZWFkZXIoXG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIsIFxuICAgICAgICAgICAgICAgIGZpbGVzTGlua2luZ1RvVGhpcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgdGhpcy5hbGxCbG9ja3MubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHRoaXMuc29ydERlc2NlbmRpbmcsXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVNvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCYWNrbGlua3MoZmlsZXNMaW5raW5nVG9UaGlzLCBvbkxpbmtDbGljayk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlQWxsQmxvY2tzKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZEhlYWRlciA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5iYWNrbGlua3MtaGVhZGVyJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvbGRIZWFkZXIgJiYgdGhpcy5jb250YWluZXIuY29udGFpbnMob2xkSGVhZGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3SGVhZGVyID0gY3JlYXRlSGVhZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yZXBsYWNlQ2hpbGQobmV3SGVhZGVyLCBvbGRIZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2Nrc0NvbGxhcHNlZCxcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5ibG9ja0JvdW5kYXJ5U3RyYXRlZ3ksXG4gICAgICAgICAgICAgICAgYXN5bmMgKHN0cmF0ZWd5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldHRpbmdzLmJsb2NrQm91bmRhcnlTdHJhdGVneSA9IHN0cmF0ZWd5O1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCbG9ja0JvdW5kYXJ5U3RyYXRlZ3koc3RyYXRlZ3kpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZUJhY2tsaW5rcyhmaWxlc0xpbmtpbmdUb1RoaXMsIG9uTGlua0NsaWNrKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRoZW1lLFxuICAgICAgICAgICAgICAgIGFzeW5jICh0aGVtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVRoZW1lQ2hhbmdlKHRoZW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGhlYWRlciA9IGNyZWF0ZUhlYWRlcigpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXIpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChsaW5rc0NvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgcHVibGljIHRvZ2dsZVNvcnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc29ydERlc2NlbmRpbmcgPSAhdGhpcy5zb3J0RGVzY2VuZGluZztcbiAgICAgICAgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0dGluZ3Muc29ydERlc2NlbmRpbmcgPSB0aGlzLnNvcnREZXNjZW5kaW5nO1xuICAgICAgICB0aGlzLnNldHRpbmdzTWFuYWdlci5zYXZlU2V0dGluZ3MoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZUFsbEJsb2NrcygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ibG9ja3NDb2xsYXBzZWQgPSAhdGhpcy5ibG9ja3NDb2xsYXBzZWQ7XG4gICAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldHRpbmdzLmJsb2Nrc0NvbGxhcHNlZCA9IHRoaXMuYmxvY2tzQ29sbGFwc2VkO1xuICAgICAgICB0aGlzLnNldHRpbmdzTWFuYWdlci5zYXZlU2V0dGluZ3MoKTtcblxuICAgICAgICAvLyBVcGRhdGUgYWxsIGJsb2NrcyBiYXNlZCBvbiB0aGUgbmV3IHN0YXRlXG4gICAgICAgIHRoaXMuYWxsQmxvY2tzLmZvckVhY2goKHsgYmxvY2sgfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmxvY2tDb250YWluZXIgPSBibG9jay5nZXRDb250YWluZXIoKTtcbiAgICAgICAgICAgIGJsb2NrQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSB0aGlzLmJsb2Nrc0NvbGxhcHNlZCA/ICdub25lJyA6ICdibG9jayc7XG4gICAgICAgICAgICBibG9jay5zZXRBcnJvd1N0YXRlKCF0aGlzLmJsb2Nrc0NvbGxhcHNlZCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNsZWFyKCkge1xuICAgICAgICAvLyBSZW1vdmUgdGhlIGNvbnRhaW5lciBmcm9tIHRoZSBET00gdG90YWxseVxuICAgICAgICBpZiAodGhpcy5jb250YWluZXIucGFyZW50RWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXIucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmNvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkJhY2tsaW5rcyB2aWV3IGNsZWFyZWRcIik7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IE1hcmtkb3duUmVuZGVyZXIsIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vTG9nZ2VyJztcblxuZXhwb3J0IGNsYXNzIEJsb2NrQ29tcG9uZW50IHtcbiAgICBwcml2YXRlIGJsb2NrQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgICBwcml2YXRlIHRvZ2dsZUJ1dHRvbjogSFRNTEVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBsb2dnZXI6IExvZ2dlcjtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgY29udGVudHM6IHN0cmluZyxcbiAgICAgICAgcHVibGljIGZpbGVQYXRoOiBzdHJpbmcsXG4gICAgICAgIHB1YmxpYyBub3RlTmFtZTogc3RyaW5nXG4gICAgKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuICAgIH1cblxuICAgIGFzeW5jIHJlbmRlcihjb250YWluZXI6IEhUTUxFbGVtZW50LCB2aWV3OiBNYXJrZG93blZpZXcsIG9uTGlua0NsaWNrOiAocGF0aDogc3RyaW5nKSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlUZXh0ID0gdGhpcy5maWxlUGF0aC5yZXBsYWNlKC9cXC5tZCQvLCAnJyk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgZGlzcGxheSB0ZXh0IGFuZCB0b2dnbGUgYnV0dG9uXG4gICAgICAgIGNvbnN0IGhlYWRlckNvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdibG9jay1oZWFkZXInIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgdG9nZ2xlIGJ1dHRvblxuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvbiA9IGhlYWRlckNvbnRhaW5lci5jcmVhdGVFbCgnc3BhbicsIHtcbiAgICAgICAgICAgIGNsczogJ3RvZ2dsZS1hcnJvdycsXG4gICAgICAgICAgICB0ZXh0OiAnXHUyNUJDJywgLy8gRG93bi1wb2ludGluZyBhcnJvdyBmb3Igb3BlbiBzdGF0ZVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBCbG9jayBoZWFkZXJcbiAgICAgICAgY29uc3QgYmxvY2tUaXRsZSA9IGhlYWRlckNvbnRhaW5lci5jcmVhdGVFbCgnYScsIHtcbiAgICAgICAgICAgIHRleHQ6IGRpc3BsYXlUZXh0LFxuICAgICAgICAgICAgY2xzOiAnYmxvY2stdGl0bGUnLFxuICAgICAgICAgICAgaHJlZjogJyMnLFxuICAgICAgICB9KTtcbiAgICAgICAgYmxvY2tUaXRsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIG9uTGlua0NsaWNrKHRoaXMuZmlsZVBhdGgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDcmVhdGUgYSBibG9jayBjb250YWluZXIgd2l0aCB0aGUgY2xhc3MgJ2JhY2tsaW5rLWl0ZW0nXG4gICAgICAgIGNvbnN0IGJsb2NrQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ2JhY2tsaW5rLWl0ZW0nIH0pO1xuXG4gICAgICAgIC8vIFJlbmRlciB0aGUgbWFya2Rvd24gY29udGVudFxuICAgICAgICBjb25zdCBjb250ZW50UHJldmlldyA9IGJsb2NrQ29udGFpbmVyLmNyZWF0ZURpdignY29udGVudC1wcmV2aWV3Jyk7XG5cbiAgICAgICAgYXdhaXQgTWFya2Rvd25SZW5kZXJlci5yZW5kZXIoXG4gICAgICAgICAgICB2aWV3LmFwcCxcbiAgICAgICAgICAgIHRoaXMuY29udGVudHMsXG4gICAgICAgICAgICBjb250ZW50UHJldmlldyxcbiAgICAgICAgICAgIHRoaXMuZmlsZVBhdGgsXG4gICAgICAgICAgICB2aWV3LFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEFkZCBjbGljayBoYW5kbGVycyBmb3IgaW50ZXJuYWwgbGlua3MsIHdpdGhvdXQgZGVidWcgbG9nZ2luZ1xuICAgICAgICBjb250ZW50UHJldmlldy5xdWVyeVNlbGVjdG9yQWxsKCdhLmludGVybmFsLWxpbmsnKS5mb3JFYWNoKChsaW5rOiBIVE1MRWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJMaW5rIGNsaWNrZWQhXCIpO1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBocmVmID0gbGluay5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICBpZiAoaHJlZikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWNvZGVkUGF0aCA9IGRlY29kZVVSSShocmVmKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIGNhbnZhcyBmaWxlIGZpcnN0LCBvdGhlcndpc2UgaGFuZGxlIGFzIG1hcmtkb3duXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bGxQYXRoID0gZGVjb2RlZFBhdGguZW5kc1dpdGgoJy5jYW52YXMnKSBcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZGVjb2RlZFBhdGggXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGRlY29kZWRQYXRoLmVuZHNXaXRoKCcubWQnKSBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGRlY29kZWRQYXRoIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogYCR7ZGVjb2RlZFBhdGh9Lm1kYDtcbiAgICAgICAgICAgICAgICAgICAgb25MaW5rQ2xpY2soZnVsbFBhdGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBJbml0aWFsbHkgc2hvdyB0aGUgZW50aXJlIGJsb2NrIGNvbnRhaW5lclxuICAgICAgICBibG9ja0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcblxuICAgICAgICAvLyBTaG93L2hpZGUgYSBzaW5nbGUgYmxvY2tcbiAgICAgICAgdGhpcy50b2dnbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpc0NvbGxhcHNlZCA9IGJsb2NrQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJztcbiAgICAgICAgICAgIGJsb2NrQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBpc0NvbGxhcHNlZCA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvbi50ZXh0Q29udGVudCA9IGlzQ29sbGFwc2VkID8gJ1x1MjVCQycgOiAnXHUyNUI2JzsgLy8gVG9nZ2xlIGFycm93IGRpcmVjdGlvblxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmJsb2NrQ29udGFpbmVyID0gYmxvY2tDb250YWluZXI7IC8vIFNhdmUgdGhlIHJlZmVyZW5jZVxuICAgIH1cblxuICAgIGdldENvbnRhaW5lcigpOiBIVE1MRWxlbWVudCB7XG4gICAgICAgIHJldHVybiB0aGlzLmJsb2NrQ29udGFpbmVyO1xuICAgIH1cblxuICAgIHNldEFycm93U3RhdGUoaXNFeHBhbmRlZDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy50b2dnbGVCdXR0b24pIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uLnRleHRDb250ZW50ID0gaXNFeHBhbmRlZCA/ICdcdTI1QkMnIDogJ1x1MjVCNic7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCAiZXhwb3J0IGNsYXNzIExvZ2dlciB7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBlbmFibGVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgc3RhdGljIGVuYWJsZSgpIHtcclxuICAgICAgICBMb2dnZXIuZW5hYmxlZCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGRpc2FibGUoKSB7XHJcbiAgICAgICAgTG9nZ2VyLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpbmZvKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChMb2dnZXIuZW5hYmxlZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlLCAuLi5vcHRpb25hbFBhcmFtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdhcm4obWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKExvZ2dlci5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihtZXNzYWdlLCAuLi5vcHRpb25hbFBhcmFtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRlYnVnKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChMb2dnZXIuZW5hYmxlZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKG1lc3NhZ2UsIC4uLm9wdGlvbmFsUGFyYW1zKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCAiZXhwb3J0IGNsYXNzIEhlYWRlckNvbXBvbmVudCB7XG4gICAgY3JlYXRlSGVhZGVyKFxuICAgICAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LCBcbiAgICAgICAgZmlsZUNvdW50OiBudW1iZXIsIFxuICAgICAgICBibG9ja0NvdW50OiBudW1iZXIsXG4gICAgICAgIHNvcnREZXNjZW5kaW5nOiBib29sZWFuLFxuICAgICAgICBvblNvcnRUb2dnbGU6ICgpID0+IHZvaWQsXG4gICAgICAgIG9uQ29sbGFwc2VUb2dnbGU6ICgpID0+IHZvaWQsXG4gICAgICAgIGlzQ29sbGFwc2VkOiBib29sZWFuLFxuICAgICAgICBjdXJyZW50U3RyYXRlZ3k6IHN0cmluZyxcbiAgICAgICAgb25TdHJhdGVneUNoYW5nZTogKHN0cmF0ZWd5OiBzdHJpbmcpID0+IHZvaWQsXG4gICAgICAgIGN1cnJlbnRUaGVtZTogc3RyaW5nLFxuICAgICAgICBvblRoZW1lQ2hhbmdlOiAodGhlbWU6IHN0cmluZykgPT4gdm9pZFxuICAgICk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGhlYWRlci5jbGFzc0xpc3QuYWRkKCdiYWNrbGlua3MtaGVhZGVyJyk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGxlZnQgY29udGFpbmVyXG4gICAgICAgIGNvbnN0IGxlZnRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgbGVmdENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdiYWNrbGlua3MtaGVhZGVyLWxlZnQnKTtcblxuICAgICAgICAvLyBDcmVhdGUgcmlnaHQgY29udGFpbmVyXG4gICAgICAgIGNvbnN0IHJpZ2h0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHJpZ2h0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2JhY2tsaW5rcy1oZWFkZXItcmlnaHQnKTtcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFkZCBjb2FsZXNjZSBpY29uXG4gICAgICAgIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwic3ZnXCIpO1xuICAgICAgICBzdmcuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgMCAxMDAgMTAwXCIpO1xuICAgICAgICBzdmcuc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgXCIxOFwiKTtcbiAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBcIjE4XCIpO1xuICAgICAgICBzdmcuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBcImN1cnJlbnRDb2xvclwiKTtcbiAgICAgICAgc3ZnLmlubmVySFRNTCA9IGA8cGF0aCBkPVwiTTg1IDQwLjVDODUgMjIuNSA3MC41IDEwIDUyLjUgMTBjLTI3LjYgMC00My4xIDI0LjUtNDMuMSA0MCAwIDIxLjcgMTYuOCA0MCA0Mi42IDQwIDExLjMgMCAyMS4xLTIuOCAyNy40LTYuNSAyLjItMS4zIDMuNi0yLjggMy42LTQuNCAwLTEuMy0wLjktMi40LTIuMi0yLjQtMC42IDAtMS4yIDAuMi0yIDAuNy02LjggNC44LTE1LjkgNy4xLTI2LjggNy4xLTIyLjMgMC0zNi4yLTE1LjQtMzYuMi0zNC41IDAtMTkuMSAxMy45LTM0LjUgMzYuMi0zNC41IDE1LjQgMCAyNy41IDEwLjMgMjcuNSAyNC41IDAgMTEuOC03LjggMTkuNS0xNi44IDE5LjUtNC45IDAtNy44LTIuNS03LjgtNi43IDAtMS4xIDAuMi0yLjMgMC41LTMuNGw0LjEtMTYuOGMwLjktMy43LTEuMS01LjYtNC01LjYtNC45IDAtOS42IDUtOS42IDEyLjMgMCA1LjYgMy4xIDkuNSA5LjMgOS41IDQuNyAwIDkuMS0xLjkgMTIuNC01LjQgMy4zIDMuNSA4LjIgNS40IDE0LjMgNS40QzczLjIgNjAgODUgNTEuNSA4NSA0MC41elwiLz5gO1xuICAgICAgICBsZWZ0Q29udGFpbmVyLmFwcGVuZENoaWxkKHN2Zyk7XG5cbiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIHRpdGxlLmNsYXNzTGlzdC5hZGQoJ2hlYWRlci10aXRsZScpO1xuICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IGAke2ZpbGVDb3VudH0gJHtmaWxlQ291bnQgPT09IDEgPyAnQmFja2xpbmsnIDogJ0JhY2tsaW5rcyd9LCAke2Jsb2NrQ291bnR9ICR7YmxvY2tDb3VudCA9PT0gMSA/ICdCbG9jaycgOiAnQmxvY2tzJ31gO1xuICAgICAgICBsZWZ0Q29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFkZCBzb3J0IGljb25cbiAgICAgICAgY29uc3Qgc29ydEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBzb3J0QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NsaWNrYWJsZS1pY29uJywgJ3NvcnQtYnV0dG9uJyk7XG4gICAgICAgIHNvcnRCdXR0b24uaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPHN2ZyB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCIgc3R5bGU9XCJ0cmFuc2Zvcm06ICR7c29ydERlc2NlbmRpbmcgPyAnbm9uZScgOiAncm90YXRlKDE4MGRlZyknfVwiPlxuICAgICAgICAgICAgICAgIDxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTQgNGw0IDQgNC00SDR6XCIvPlxuICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgIGA7XG4gICAgICAgIHNvcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvblNvcnRUb2dnbGUpO1xuICAgICAgICBsZWZ0Q29udGFpbmVyLmFwcGVuZENoaWxkKHNvcnRCdXR0b24pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBhbmQgYWRkIGNvbGxhcHNlL2V4cGFuZCBhbGwgaWNvblxuICAgICAgICBjb25zdCBjb2xsYXBzZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBjb2xsYXBzZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjbGlja2FibGUtaWNvbicsICdjb2xsYXBzZS1idXR0b24nKTtcbiAgICAgICAgY29sbGFwc2VCdXR0b24uaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPHN2ZyB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCIgc3R5bGU9XCJ0cmFuc2Zvcm06ICR7aXNDb2xsYXBzZWQgPyAncm90YXRlKC05MGRlZyknIDogJ25vbmUnfVwiPlxuICAgICAgICAgICAgICAgIDxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTQgNGw0IDQgNC00SDR6XCIvPlxuICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgIGA7XG4gICAgICAgIGNvbGxhcHNlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25Db2xsYXBzZVRvZ2dsZSk7XG4gICAgICAgIGxlZnRDb250YWluZXIuYXBwZW5kQ2hpbGQoY29sbGFwc2VCdXR0b24pO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGFuZCBhZGQgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5U2VsZWN0IGRyb3Bkb3duXG4gICAgICAgIGNvbnN0IGJsb2NrQm91bmRhcnlTdHJhdGVneVNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpO1xuICAgICAgICBibG9ja0JvdW5kYXJ5U3RyYXRlZ3lTZWxlY3QuY2xhc3NMaXN0LmFkZCgnc3RyYXRlZ3ktc2VsZWN0Jyk7XG4gICAgICAgIGNvbnN0IGJsb2NrQm91bmRhcnlTdHJhdGVnaWVzID0gWydkZWZhdWx0JywgJ3NpbmdsZS1saW5lJ107XG4gICAgICAgIGJsb2NrQm91bmRhcnlTdHJhdGVnaWVzLmZvckVhY2goc3RyYXRlZ3kgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgICAgICBvcHRpb24udmFsdWUgPSBzdHJhdGVneTtcbiAgICAgICAgICAgIG9wdGlvbi50ZXh0Q29udGVudCA9IHN0cmF0ZWd5LnJlcGxhY2UoJy0nLCAnICcpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBzdHJhdGVneSA9PT0gY3VycmVudFN0cmF0ZWd5O1xuICAgICAgICAgICAgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5U2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgICBibG9ja0JvdW5kYXJ5U3RyYXRlZ3lTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgb25TdHJhdGVneUNoYW5nZShibG9ja0JvdW5kYXJ5U3RyYXRlZ3lTZWxlY3QudmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgbGVmdENvbnRhaW5lci5hcHBlbmRDaGlsZChibG9ja0JvdW5kYXJ5U3RyYXRlZ3lTZWxlY3QpO1xuXG4gICAgICAgIC8vIEFkZCB0aGVtZSBzZWxlY3RvciBkcm9wZG93blxuICAgICAgICBjb25zdCB0aGVtZVNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpO1xuICAgICAgICB0aGVtZVNlbGVjdC5jbGFzc0xpc3QuYWRkKCd0aGVtZS1zZWxlY3QnKTtcbiAgICAgICAgY29uc3QgdGhlbWVzID0gWydkZWZhdWx0JywgJ21pbmltYWwnLCAnbW9kZXJuJ107XG4gICAgICAgIHRoZW1lcy5mb3JFYWNoKHRoZW1lID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gdGhlbWU7XG4gICAgICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSB0aGVtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoZW1lLnNsaWNlKDEpO1xuICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdGhlbWUgPT09IGN1cnJlbnRUaGVtZTtcbiAgICAgICAgICAgIHRoZW1lU2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGVtZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBvblRoZW1lQ2hhbmdlKHRoZW1lU2VsZWN0LnZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxlZnRDb250YWluZXIuYXBwZW5kQ2hpbGQodGhlbWVTZWxlY3QpO1xuXG4gICAgICAgIC8vIEFkZCBzZXR0aW5ncyBidXR0b24gYmVmb3JlIHRoZSB0aGVtZSBzZWxlY3RvclxuICAgICAgICBjb25zdCBzZXR0aW5nc0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBzZXR0aW5nc0J1dHRvbi5jbGFzc05hbWUgPSAnc2V0dGluZ3MtYnV0dG9uJztcbiAgICAgICAgc2V0dGluZ3NCdXR0b24uaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIxNlwiIGhlaWdodD1cIjE2XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgc3Ryb2tlLXdpZHRoPVwiMlwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiPlxuICAgICAgICAgICAgICAgIDxjaXJjbGUgY3g9XCIxMlwiIGN5PVwiMTJcIiByPVwiM1wiPjwvY2lyY2xlPlxuICAgICAgICAgICAgICAgIDxwYXRoIGQ9XCJNMTkuNCAxNWExLjY1IDEuNjUgMCAwIDAgLjMzIDEuODJsLjA2LjA2YTIgMiAwIDAgMSAwIDIuODMgMiAyIDAgMCAxLTIuODMgMGwtLjA2LS4wNmExLjY1IDEuNjUgMCAwIDAtMS44Mi0uMzMgMS42NSAxLjY1IDAgMCAwLTEgMS41MVYyMWEyIDIgMCAwIDEtMiAyIDIgMiAwIDAgMS0yLTJ2LS4wOUExLjY1IDEuNjUgMCAwIDAgOSAxOS40YTEuNjUgMS42NSAwIDAgMC0xLjgyLjMzbC0uMDYuMDZhMiAyIDAgMCAxLTIuODMgMCAyIDIgMCAwIDEgMC0yLjgzbC4wNi0uMDZhMS42NSAxLjY1IDAgMCAwIC4zMy0xLjgyIDEuNjUgMS42NSAwIDAgMC0xLjUxLTFIM2EyIDIgMCAwIDEtMi0yIDIgMiAwIDAgMSAyLTJoLjA5QTEuNjUgMS42NSAwIDAgMCA0LjYgOWExLjY1IDEuNjUgMCAwIDAtLjMzLTEuODJsLS4wNi0uMDZhMiAyIDAgMCAxIDAtMi44MyAyIDIgMCAwIDEgMi44MyAwbC4wNi4wNmExLjY1IDEuNjUgMCAwIDAgMS44Mi4zM0g5YTEuNjUgMS42NSAwIDAgMCAxLTEuNTFWM2EyIDIgMCAwIDEgMi0yIDIgMiAwIDAgMSAyIDJ2LjA5YTEuNjUgMS42NSAwIDAgMCAxIDEuNTEgMS42NSAxLjY1IDAgMCAwIDEuODItLjMzbC4wNi0uMDZhMiAyIDAgMCAxIDIuODMgMCAyIDIgMCAwIDEgMCAyLjgzbC0uMDYuMDZhMS42NSAxLjY1IDAgMCAwLS4zMyAxLjgyVjlhMS42NSAxLjY1IDAgMCAwIDEuNTEgMUgyMWEyIDIgMCAwIDEgMiAyIDIgMiAwIDAgMS0yIDJoLS4wOWExLjY1IDEuNjUgMCAwIDAtMS41MSAxelwiPjwvcGF0aD5cbiAgICAgICAgICAgIDwvc3ZnPlxuICAgICAgICBgO1xuXG4gICAgICAgIGxldCBwb3B1cDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICAgICAgICBzZXR0aW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocG9wdXApIHtcbiAgICAgICAgICAgICAgICBwb3B1cC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBwb3B1cCA9IG51bGw7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwb3B1cCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgcG9wdXAuY2xhc3NOYW1lID0gJ3NldHRpbmdzLXBvcHVwJztcblxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHNldHRpbmdJdGVtLmNsYXNzTmFtZSA9ICdzZXR0aW5ncy1pdGVtJztcbiAgICAgICAgICAgIHNldHRpbmdJdGVtLnRleHRDb250ZW50ID0gJ1BsYWNlaG9sZGVyIFNldHRpbmcnO1xuICAgICAgICAgICAgcG9wdXAuYXBwZW5kQ2hpbGQoc2V0dGluZ0l0ZW0pO1xuXG4gICAgICAgICAgICAvLyBQb3NpdGlvbiB0aGUgcG9wdXAgYmVsb3cgdGhlIGJ1dHRvblxuICAgICAgICAgICAgY29uc3QgcmVjdCA9IHNldHRpbmdzQnV0dG9uLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgcG9wdXAuc3R5bGUudG9wID0gYCR7cmVjdC5ib3R0b20gKyA1fXB4YDtcbiAgICAgICAgICAgIHBvcHVwLnN0eWxlLmxlZnQgPSBgJHtyZWN0LmxlZnR9cHhgO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcHVwKTtcblxuICAgICAgICAgICAgLy8gQ2xvc2UgcG9wdXAgd2hlbiBjbGlja2luZyBvdXRzaWRlXG4gICAgICAgICAgICBjb25zdCBjbG9zZVBvcHVwID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocG9wdXAgJiYgIXBvcHVwLmNvbnRhaW5zKGUudGFyZ2V0IGFzIE5vZGUpICYmIGUudGFyZ2V0ICE9PSBzZXR0aW5nc0J1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICBwb3B1cC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgcG9wdXAgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlUG9wdXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xvc2VQb3B1cCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCBpdGVtcyB0byBsZWZ0IGNvbnRhaW5lclxuICAgICAgICBsZWZ0Q29udGFpbmVyLmFwcGVuZENoaWxkKHN2Zyk7XG4gICAgICAgIGxlZnRDb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuICAgICAgICBsZWZ0Q29udGFpbmVyLmFwcGVuZENoaWxkKHNvcnRCdXR0b24pO1xuICAgICAgICBsZWZ0Q29udGFpbmVyLmFwcGVuZENoaWxkKGNvbGxhcHNlQnV0dG9uKTtcbiAgICAgICAgbGVmdENvbnRhaW5lci5hcHBlbmRDaGlsZChibG9ja0JvdW5kYXJ5U3RyYXRlZ3lTZWxlY3QpO1xuICAgICAgICBsZWZ0Q29udGFpbmVyLmFwcGVuZENoaWxkKHRoZW1lU2VsZWN0KTtcblxuICAgICAgICAvLyBBZGQgaXRlbXMgdG8gcmlnaHQgY29udGFpbmVyXG4gICAgICAgIHJpZ2h0Q29udGFpbmVyLmFwcGVuZENoaWxkKHNldHRpbmdzQnV0dG9uKTtcblxuICAgICAgICAvLyBBZGQgY29udGFpbmVycyB0byBoZWFkZXJcbiAgICAgICAgaGVhZGVyLmFwcGVuZENoaWxkKGxlZnRDb250YWluZXIpO1xuICAgICAgICBoZWFkZXIuYXBwZW5kQ2hpbGQocmlnaHRDb250YWluZXIpO1xuXG4gICAgICAgIHJldHVybiBoZWFkZXI7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IEJsb2NrQm91bmRhcnlTdHJhdGVneSB9IGZyb20gJy4vQmxvY2tCb3VuZGFyeVN0cmF0ZWd5JztcclxuXHJcbmV4cG9ydCBjbGFzcyBEZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5IGltcGxlbWVudHMgQmxvY2tCb3VuZGFyeVN0cmF0ZWd5IHtcclxuICAgIGZpbmRCbG9ja0JvdW5kYXJpZXMoY29udGVudDogc3RyaW5nLCBjdXJyZW50Tm90ZU5hbWU6IHN0cmluZyk6IHsgc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIgfVtdIHtcclxuICAgICAgICBjb25zdCBib3VuZGFyaWVzOiB7IHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyIH1bXSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgXFxcXFtcXFxcWyR7Y3VycmVudE5vdGVOYW1lfVxcXFxdXFxcXF1gLCAnZycpO1xyXG4gICAgICAgIGxldCBtYXRjaDtcclxuXHJcbiAgICAgICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWMoY29udGVudCkpICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmVTdGFydEluZGV4ID0gY29udGVudC5sYXN0SW5kZXhPZignXFxuJywgbWF0Y2guaW5kZXgpICsgMTtcclxuICAgICAgICAgICAgY29uc3QgZW5kSW5kZXggPSBjb250ZW50LmluZGV4T2YoJy0tLScsIG1hdGNoLmluZGV4KTtcclxuICAgICAgICAgICAgY29uc3QgbmV4dE1lbnRpb25JbmRleCA9IGNvbnRlbnQuaW5kZXhPZihgW1ske2N1cnJlbnROb3RlTmFtZX1dXWAsIG1hdGNoLmluZGV4ICsgMSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgYmxvY2tFbmRJbmRleCA9IGNvbnRlbnQubGVuZ3RoO1xyXG4gICAgICAgICAgICBpZiAoZW5kSW5kZXggIT09IC0xICYmIChuZXh0TWVudGlvbkluZGV4ID09PSAtMSB8fCBlbmRJbmRleCA8IG5leHRNZW50aW9uSW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICBibG9ja0VuZEluZGV4ID0gZW5kSW5kZXg7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV4dE1lbnRpb25JbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGJsb2NrRW5kSW5kZXggPSBuZXh0TWVudGlvbkluZGV4O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBib3VuZGFyaWVzLnB1c2goeyBzdGFydDogbGluZVN0YXJ0SW5kZXgsIGVuZDogYmxvY2tFbmRJbmRleCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBib3VuZGFyaWVzO1xyXG4gICAgfVxyXG59XHJcbiIsICJpbXBvcnQgeyBCbG9ja0JvdW5kYXJ5U3RyYXRlZ3kgfSBmcm9tICcuL0Jsb2NrQm91bmRhcnlTdHJhdGVneSc7XHJcblxyXG5leHBvcnQgY2xhc3MgU2luZ2xlTGluZUJsb2NrQm91bmRhcnlTdHJhdGVneSBpbXBsZW1lbnRzIEJsb2NrQm91bmRhcnlTdHJhdGVneSB7XHJcbiAgICBmaW5kQmxvY2tCb3VuZGFyaWVzKGNvbnRlbnQ6IHN0cmluZywgY3VycmVudE5vdGVOYW1lOiBzdHJpbmcpOiB7IHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyIH1bXSB7XHJcbiAgICAgICAgY29uc3QgYm91bmRhcmllczogeyBzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlciB9W10gPSBbXTtcclxuICAgICAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgICBpZiAobGluZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdExpbmUgPSBsaW5lc1swXTtcclxuICAgICAgICAgICAgYm91bmRhcmllcy5wdXNoKHsgc3RhcnQ6IDAsIGVuZDogZmlyc3RMaW5lLmxlbmd0aCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBib3VuZGFyaWVzO1xyXG4gICAgfVxyXG59XHJcbiIsICJpbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IFNldHRpbmdzTWFuYWdlciB9IGZyb20gJy4vU2V0dGluZ3NNYW5hZ2VyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2FsZXNjZVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIGFwcDogQXBwLFxyXG4gICAgICAgIHByaXZhdGUgcGx1Z2luOiBhbnksXHJcbiAgICAgICAgcHJpdmF0ZSBzZXR0aW5nc01hbmFnZXI6IFNldHRpbmdzTWFuYWdlclxyXG4gICAgKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1Nob3cgaW4gRGFpbHkgTm90ZXMnKVxyXG4gICAgICAgICAgICAuc2V0RGVzYygnRW5hYmxlIENvYWxlc2NlIHZpZXcgaW4gZGFpbHkgbm90ZXMnKVxyXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcclxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5zaG93SW5EYWlseU5vdGVzKVxyXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldHRpbmdzLnNob3dJbkRhaWx5Tm90ZXMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgIH1cclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQW1DOzs7QUNTbkMsSUFBTSxtQkFBMkM7QUFBQSxFQUM3QyxXQUFXO0FBQUEsRUFDWCxnQkFBZ0I7QUFBQSxFQUNoQixpQkFBaUI7QUFBQSxFQUNqQixrQkFBa0I7QUFBQSxFQUNsQix1QkFBdUI7QUFBQSxFQUN2QixPQUFPO0FBQ1g7QUFnQk8sSUFBTSxrQkFBTixN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QUFDZCxjQUFRLElBQUksaUJBQWlCO0FBQUEsSUFDOUI7QUFDQSxJQUFDLE9BQWUsaUJBQWlCLFdBQVc7QUFDM0MsYUFBTyxRQUFRO0FBQ2YsY0FBUSxJQUFJLGtCQUFrQjtBQUFBLElBQy9CO0FBQUEsRUFDRDtBQUFBLEVBRUEsV0FBVztBQUNWLFNBQUssZ0JBQWdCLGVBQWU7QUFBQSxFQUNyQztBQUFBLEVBRVEsWUFBWSxNQUFzQjtBQUV6QyxVQUFNLG1CQUFvQixLQUFLLElBQVksZ0JBQWdCLFFBQVEsYUFBYTtBQUNoRixRQUFJLENBQUMsb0JBQW9CLENBQUMsaUJBQWlCLFNBQVM7QUFDbkQsV0FBSyxPQUFPLE1BQU0sb0NBQW9DO0FBQ3RELGFBQU87QUFBQSxJQUNSO0FBR0EsVUFBTSxtQkFBbUIsaUJBQWlCLFNBQVMsUUFBUSxVQUFVO0FBQ3JFLFFBQUksQ0FBQyxrQkFBa0I7QUFDdEIsV0FBSyxPQUFPLE1BQU0sK0NBQStDO0FBQUEsSUFDbEU7QUFFQSxVQUFNLG1CQUFtQjtBQUd6QixRQUFJLENBQUMsS0FBSyxLQUFLLFdBQVcsZ0JBQWdCLEdBQUc7QUFDNUMsYUFBTztBQUFBLElBQ1I7QUFHQSxXQUFPLGlCQUFpQixLQUFLLEtBQUssSUFBSTtBQUFBLEVBQ3ZDO0FBQ0Q7IiwKICAibmFtZXMiOiBbImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImUiLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
