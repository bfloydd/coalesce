/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => CoalescePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian5 = require("obsidian");

// src/SettingsManager.ts
var DEFAULT_SETTINGS = {
  mySetting: "default",
  sortDescending: true,
  blocksCollapsed: true,
  showInDailyNotes: false,
  blockBoundaryStrategy: "default"
};
var SettingsManager = class {
  constructor(plugin) {
    this.plugin = plugin;
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.plugin.loadData());
  }
  async saveSettings() {
    await this.plugin.saveData(this.settings);
  }
};

// src/CoalesceManager.ts
var import_obsidian3 = require("obsidian");

// src/CoalesceView.ts
var import_obsidian2 = require("obsidian");

// src/BlockComponent.ts
var import_obsidian = require("obsidian");

// src/Logger.ts
var _Logger = class {
  static enable() {
    _Logger.enabled = true;
  }
  static disable() {
    _Logger.enabled = false;
  }
  info(message, ...optionalParams) {
    if (_Logger.enabled) {
      console.log(message, ...optionalParams);
    }
  }
  warn(message, ...optionalParams) {
    if (_Logger.enabled) {
      console.warn(message, ...optionalParams);
    }
  }
  debug(message, ...optionalParams) {
    if (_Logger.enabled) {
      console.debug(message, ...optionalParams);
    }
  }
};
var Logger = _Logger;
Logger.enabled = false;

// src/BlockComponent.ts
var BlockComponent = class {
  constructor(contents, filePath, noteName) {
    this.contents = contents;
    this.filePath = filePath;
    this.noteName = noteName;
    this.logger = new Logger();
  }
  async render(container, view, onLinkClick) {
    const displayText = this.filePath.replace(/\.md$/, "");
    const headerContainer = container.createDiv({ cls: "block-header" });
    this.toggleButton = headerContainer.createEl("span", {
      cls: "toggle-arrow",
      text: "\u25BC"
      // Down-pointing arrow for open state
    });
    const blockTitle = headerContainer.createEl("a", {
      text: displayText,
      cls: "block-title",
      href: "#"
    });
    blockTitle.addEventListener("click", (event) => {
      event.preventDefault();
      onLinkClick(this.filePath);
    });
    const blockContainer = container.createDiv({ cls: "backlink-item" });
    const contentPreview = blockContainer.createDiv("content-preview");
    await import_obsidian.MarkdownRenderer.render(
      view.app,
      this.contents,
      contentPreview,
      this.filePath,
      view
    );
    contentPreview.querySelectorAll("a.internal-link").forEach((link) => {
      link.addEventListener("click", (event) => {
        this.logger.info("Link clicked!");
        event.preventDefault();
        const href = link.getAttribute("href");
        if (href) {
          const decodedPath = decodeURI(href);
          const fullPath = decodedPath.endsWith(".canvas") ? decodedPath : decodedPath.endsWith(".md") ? decodedPath : `${decodedPath}.md`;
          onLinkClick(fullPath);
        }
      });
    });
    blockContainer.style.display = "block";
    this.toggleButton.addEventListener("click", () => {
      const isCollapsed = blockContainer.style.display === "none";
      blockContainer.style.display = isCollapsed ? "block" : "none";
      this.toggleButton.textContent = isCollapsed ? "\u25BC" : "\u25B6";
    });
    this.blockContainer = blockContainer;
  }
  getContainer() {
    return this.blockContainer;
  }
  setArrowState(isExpanded) {
    if (this.toggleButton) {
      this.toggleButton.textContent = isExpanded ? "\u25BC" : "\u25B6";
    }
  }
};

// src/HeaderComponent.ts
var HeaderComponent = class {
  createHeader(container, fileCount, blockCount, sortDescending, onSortToggle, onCollapseToggle, isCollapsed, currentStrategy, onStrategyChange) {
    const header = document.createElement("div");
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("viewBox", "0 0 100 100");
    svg.setAttribute("width", "18");
    svg.setAttribute("height", "18");
    svg.setAttribute("fill", "currentColor");
    svg.innerHTML = `<path d="M85 40.5C85 22.5 70.5 10 52.5 10c-27.6 0-43.1 24.5-43.1 40 0 21.7 16.8 40 42.6 40 11.3 0 21.1-2.8 27.4-6.5 2.2-1.3 3.6-2.8 3.6-4.4 0-1.3-0.9-2.4-2.2-2.4-0.6 0-1.2 0.2-2 0.7-6.8 4.8-15.9 7.1-26.8 7.1-22.3 0-36.2-15.4-36.2-34.5 0-19.1 13.9-34.5 36.2-34.5 15.4 0 27.5 10.3 27.5 24.5 0 11.8-7.8 19.5-16.8 19.5-4.9 0-7.8-2.5-7.8-6.7 0-1.1 0.2-2.3 0.5-3.4l4.1-16.8c0.9-3.7-1.1-5.6-4-5.6-4.9 0-9.6 5-9.6 12.3 0 5.6 3.1 9.5 9.3 9.5 4.7 0 9.1-1.9 12.4-5.4 3.3 3.5 8.2 5.4 14.3 5.4C73.2 60 85 51.5 85 40.5z"/>`;
    header.appendChild(svg);
    header.classList.add("backlinks-header");
    const title = document.createElement("span");
    title.classList.add("header-title");
    title.textContent = `${fileCount} ${fileCount === 1 ? "Backlink" : "Backlinks"}, ${blockCount} ${blockCount === 1 ? "Block" : "Blocks"}`;
    header.appendChild(title);
    const sortButton = document.createElement("button");
    sortButton.classList.add("clickable-icon", "sort-button");
    sortButton.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 16 16" style="transform: ${sortDescending ? "none" : "rotate(180deg)"}">
                <path fill="currentColor" d="M4 4l4 4 4-4H4z"/>
            </svg>
        `;
    sortButton.addEventListener("click", onSortToggle);
    header.appendChild(sortButton);
    const collapseButton = document.createElement("button");
    collapseButton.classList.add("clickable-icon", "collapse-button");
    collapseButton.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 16 16" style="transform: ${isCollapsed ? "rotate(-90deg)" : "none"}">
                <path fill="currentColor" d="M4 4l4 4 4-4H4z"/>
            </svg>
        `;
    collapseButton.addEventListener("click", onCollapseToggle);
    header.appendChild(collapseButton);
    const blockBoundaryStrategySelect = document.createElement("select");
    blockBoundaryStrategySelect.classList.add("strategy-select");
    const blockBoundaryStrategies = ["default", "single-line"];
    blockBoundaryStrategies.forEach((strategy) => {
      const option = document.createElement("option");
      option.value = strategy;
      option.textContent = strategy.replace("-", " ").toUpperCase();
      option.selected = strategy === currentStrategy;
      blockBoundaryStrategySelect.appendChild(option);
    });
    blockBoundaryStrategySelect.addEventListener("change", () => {
      onStrategyChange(blockBoundaryStrategySelect.value);
    });
    header.appendChild(blockBoundaryStrategySelect);
    return header;
  }
};

// src/DefaultBlockBoundaryStrategy.ts
var DefaultBlockBoundaryStrategy = class {
  findBlockBoundaries(content, currentNoteName) {
    const boundaries = [];
    const regex = new RegExp(`\\[\\[${currentNoteName}\\]\\]`, "g");
    let match;
    while ((match = regex.exec(content)) !== null) {
      const lineStartIndex = content.lastIndexOf("\n", match.index) + 1;
      const endIndex = content.indexOf("---", match.index);
      const nextMentionIndex = content.indexOf(`[[${currentNoteName}]]`, match.index + 1);
      let blockEndIndex = content.length;
      if (endIndex !== -1 && (nextMentionIndex === -1 || endIndex < nextMentionIndex)) {
        blockEndIndex = endIndex;
      } else if (nextMentionIndex !== -1) {
        blockEndIndex = nextMentionIndex;
      }
      boundaries.push({ start: lineStartIndex, end: blockEndIndex });
    }
    return boundaries;
  }
};

// src/SingleLineBlockBoundaryStrategy.ts
var SingleLineBlockBoundaryStrategy = class {
  findBlockBoundaries(content, currentNoteName) {
    const boundaries = [];
    const lines = content.split("\n");
    if (lines.length > 0) {
      const firstLine = lines[0];
      boundaries.push({ start: 0, end: firstLine.length });
    }
    return boundaries;
  }
};

// src/CoalesceView.ts
var CoalesceView = class {
  constructor(view, currentNoteName, settingsManager, blockBoundaryStrategy) {
    this.view = view;
    this.settingsManager = settingsManager;
    this.logger = new Logger();
    this.headerComponent = new HeaderComponent();
    this.allBlocks = [];
    this.currentNoteName = currentNoteName;
    this.blockBoundaryStrategy = blockBoundaryStrategy;
    this.sortDescending = this.settingsManager.settings.sortDescending;
    this.blocksCollapsed = this.settingsManager.settings.blocksCollapsed;
    this.container = this.createBacklinksContainer();
    this.logger.info("Appending backlinks container to the view");
    const markdownContent = this.view.containerEl.querySelector(".markdown-preview-view") || this.view.contentEl;
    if (markdownContent) {
      markdownContent.classList.add("markdown-content");
      markdownContent.appendChild(this.container);
    } else {
      this.logger.warn("Markdown content area not found.");
    }
  }
  createBacklinksContainer() {
    const container = document.createElement("div");
    container.classList.add("custom-backlinks-container");
    return container;
  }
  async getBlockData(filePath, currentNoteName) {
    const blocks = [];
    try {
      const file = this.view.app.vault.getAbstractFileByPath(filePath);
      if (file && file instanceof import_obsidian2.TFile) {
        const content = await this.view.app.vault.read(file);
        const boundaries = this.blockBoundaryStrategy.findBlockBoundaries(content, currentNoteName);
        for (const { start, end } of boundaries) {
          const blockContent = content.substring(start, end);
          const block = new BlockComponent(blockContent, filePath, currentNoteName);
          blocks.push(block);
        }
      }
    } catch (error) {
      console.error(`Error reading file content for ${filePath}:`, error);
    }
    return blocks;
  }
  updateBlockBoundaryStrategy(strategy) {
    switch (strategy) {
      case "single-line":
        this.blockBoundaryStrategy = new SingleLineBlockBoundaryStrategy();
        break;
      case "default":
      default:
        this.blockBoundaryStrategy = new DefaultBlockBoundaryStrategy();
        break;
    }
  }
  async updateBacklinks(filesLinkingToThis, onLinkClick) {
    this.logger.info("Updating backlinks:", filesLinkingToThis);
    this.container.empty();
    const linksContainer = this.container.createDiv("backlinks-list");
    this.logger.info("Links container:", linksContainer);
    this.allBlocks = [];
    for (const sourcePath of filesLinkingToThis) {
      const blocks = await this.getBlockData(sourcePath, this.currentNoteName);
      blocks.forEach((block) => {
        this.allBlocks.push({ block, sourcePath });
      });
    }
    this.allBlocks.sort((a, b) => this.sortDescending ? b.sourcePath.localeCompare(a.sourcePath) : a.sourcePath.localeCompare(b.sourcePath));
    for (const { block } of this.allBlocks) {
      await block.render(linksContainer, this.view, onLinkClick);
      const blockContainer = block.getContainer();
      blockContainer.style.display = this.blocksCollapsed ? "none" : "block";
      block.setArrowState(!this.blocksCollapsed);
    }
    const createHeader = () => {
      return this.headerComponent.createHeader(
        this.container,
        filesLinkingToThis.length,
        this.allBlocks.length,
        this.sortDescending,
        () => {
          this.toggleSort();
          this.updateBacklinks(filesLinkingToThis, onLinkClick);
        },
        () => {
          this.toggleAllBlocks();
          const oldHeader = this.container.querySelector(".backlinks-header");
          if (oldHeader && this.container.contains(oldHeader)) {
            const newHeader = createHeader();
            this.container.replaceChild(newHeader, oldHeader);
          }
        },
        this.blocksCollapsed,
        this.settingsManager.settings.blockBoundaryStrategy,
        async (strategy) => {
          this.settingsManager.settings.blockBoundaryStrategy = strategy;
          await this.settingsManager.saveSettings();
          this.updateBlockBoundaryStrategy(strategy);
          await this.updateBacklinks(filesLinkingToThis, onLinkClick);
        }
      );
    };
    const header = createHeader();
    this.container.appendChild(header);
    this.container.appendChild(linksContainer);
  }
  toggleSort() {
    this.sortDescending = !this.sortDescending;
    this.settingsManager.settings.sortDescending = this.sortDescending;
    this.settingsManager.saveSettings();
  }
  toggleAllBlocks() {
    this.blocksCollapsed = !this.blocksCollapsed;
    this.settingsManager.settings.blocksCollapsed = this.blocksCollapsed;
    this.settingsManager.saveSettings();
    this.allBlocks.forEach(({ block }) => {
      const blockContainer = block.getContainer();
      blockContainer.style.display = this.blocksCollapsed ? "none" : "block";
      block.setArrowState(!this.blocksCollapsed);
    });
  }
  clear() {
    if (this.container.parentElement) {
      this.container.parentElement.removeChild(this.container);
    }
    this.logger.info("Backlinks view cleared");
  }
};

// src/CoalesceManager.ts
var CoalesceManager = class {
  constructor(app, settingsManager) {
    this.app = app;
    this.settingsManager = settingsManager;
    this.coalesceView = null;
    this.logger = new Logger();
  }
  handleFileOpen(file) {
    if (!file)
      return;
    const view = this.app.workspace.getActiveViewOfType(import_obsidian3.MarkdownView);
    if (!view)
      return;
    if (this.coalesceView) {
      this.coalesceView.clear();
    }
    const currentNoteName = file.basename;
    const blockBoundaryStrategy = this.getStrategyFromSettings();
    this.coalesceView = new CoalesceView(view, currentNoteName, this.settingsManager, blockBoundaryStrategy);
    const backlinks = this.app.metadataCache.resolvedLinks;
    const filesLinkingToThis = Object.entries(backlinks).filter(([_, links]) => file.path in links).map(([sourcePath]) => sourcePath);
    this.coalesceView.updateBacklinks(filesLinkingToThis, (path) => {
      this.app.workspace.openLinkText(path, "", false);
    });
  }
  getStrategyFromSettings() {
    const blockBoundaryStrategy = this.settingsManager.settings.blockBoundaryStrategy;
    switch (blockBoundaryStrategy) {
      case "single-line":
        return new SingleLineBlockBoundaryStrategy();
      case "default":
      default:
        return new DefaultBlockBoundaryStrategy();
    }
  }
  clearBacklinks() {
    if (this.coalesceView) {
      this.coalesceView.clear();
    }
  }
};

// src/SettingsTab.ts
var import_obsidian4 = require("obsidian");
var CoalesceSettingTab = class extends import_obsidian4.PluginSettingTab {
  constructor(app, plugin, settingsManager) {
    super(app, plugin);
    this.plugin = plugin;
    this.settingsManager = settingsManager;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian4.Setting(containerEl).setName("Show in Daily Notes").setDesc("Enable Coalesce view in daily notes").addToggle((toggle) => toggle.setValue(this.settingsManager.settings.showInDailyNotes).onChange(async (value) => {
      this.settingsManager.settings.showInDailyNotes = value;
      await this.settingsManager.saveSettings();
    }));
  }
};

// main.ts
var CoalescePlugin = class extends import_obsidian5.Plugin {
  async onload() {
    this.logger = new Logger();
    this.settingsManager = new SettingsManager(this);
    await this.settingsManager.loadSettings();
    this.addSettingTab(new CoalesceSettingTab(this.app, this, this.settingsManager));
    this.coalesceManager = new CoalesceManager(this.app, this.settingsManager);
    this.app.workspace.on("file-open", (file) => {
      if (!file)
        return;
      const isDaily = this.isDailyNote(file);
      if (!isDaily || isDaily && this.settingsManager.settings.showInDailyNotes) {
        this.coalesceManager.handleFileOpen(file);
      } else {
        this.coalesceManager.clearBacklinks();
      }
    });
    window.enableLogging = function() {
      Logger.enable();
      console.log("Logging enabled");
    };
    window.disableLogging = function() {
      Logger.disable();
      console.log("Logging disabled");
    };
  }
  onunload() {
    this.coalesceManager.clearBacklinks();
  }
  isDailyNote(file) {
    const dailyNotesPlugin = this.app.internalPlugins.plugins["daily-notes"];
    if (!dailyNotesPlugin || !dailyNotesPlugin.enabled) {
      this.logger.debug("Daily Notes plugin is not enabled.");
      return false;
    }
    const dailyNotesFolder = dailyNotesPlugin.instance.options.folder || "";
    if (!dailyNotesFolder) {
      this.logger.debug("Daily Notes folder not set, using vault root.");
    }
    const dailyNotePattern = /^\d{4}-\d{2}-\d{2}\.md$/;
    if (!file.path.startsWith(dailyNotesFolder)) {
      return false;
    }
    return dailyNotePattern.test(file.name);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvU2V0dGluZ3NNYW5hZ2VyLnRzIiwgInNyYy9Db2FsZXNjZU1hbmFnZXIudHMiLCAic3JjL0NvYWxlc2NlVmlldy50cyIsICJzcmMvQmxvY2tDb21wb25lbnQudHMiLCAic3JjL0xvZ2dlci50cyIsICJzcmMvSGVhZGVyQ29tcG9uZW50LnRzIiwgInNyYy9EZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5LnRzIiwgInNyYy9TaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5LnRzIiwgInNyYy9TZXR0aW5nc1RhYi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSAnLi9zcmMvU2V0dGluZ3NNYW5hZ2VyJztcbmltcG9ydCB7IENvYWxlc2NlTWFuYWdlciB9IGZyb20gJy4vc3JjL0NvYWxlc2NlTWFuYWdlcic7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuL3NyYy9Mb2dnZXInO1xuaW1wb3J0IHsgQ29hbGVzY2VTZXR0aW5nVGFiIH0gZnJvbSAnLi9zcmMvU2V0dGluZ3NUYWInO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb2FsZXNjZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdHByaXZhdGUgc2V0dGluZ3NNYW5hZ2VyOiBTZXR0aW5nc01hbmFnZXI7XG5cdHByaXZhdGUgY29hbGVzY2VNYW5hZ2VyOiBDb2FsZXNjZU1hbmFnZXI7XG5cdHByaXZhdGUgbG9nZ2VyOiBMb2dnZXI7XG5cblx0YXN5bmMgb25sb2FkKCkge1xuXHRcdHRoaXMubG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXHRcdHRoaXMuc2V0dGluZ3NNYW5hZ2VyID0gbmV3IFNldHRpbmdzTWFuYWdlcih0aGlzKTtcblx0XHRhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5sb2FkU2V0dGluZ3MoKTtcblxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgQ29hbGVzY2VTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzLCB0aGlzLnNldHRpbmdzTWFuYWdlcikpO1xuXG5cdFx0dGhpcy5jb2FsZXNjZU1hbmFnZXIgPSBuZXcgQ29hbGVzY2VNYW5hZ2VyKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzTWFuYWdlcik7XG5cdFx0dGhpcy5hcHAud29ya3NwYWNlLm9uKCdmaWxlLW9wZW4nLCAoZmlsZTogVEZpbGUpID0+IHtcblx0XHRcdGlmICghZmlsZSkgcmV0dXJuO1xuXHRcdFx0XG5cdFx0XHRjb25zdCBpc0RhaWx5ID0gdGhpcy5pc0RhaWx5Tm90ZShmaWxlKTtcblx0XHRcdGlmICghaXNEYWlseSB8fCAoaXNEYWlseSAmJiB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5zaG93SW5EYWlseU5vdGVzKSkge1xuXHRcdFx0XHR0aGlzLmNvYWxlc2NlTWFuYWdlci5oYW5kbGVGaWxlT3BlbihmaWxlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29hbGVzY2VNYW5hZ2VyLmNsZWFyQmFja2xpbmtzKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBMb2dnaW5nXG5cdFx0ICogVXNhZ2U6IEluIHRoZSBicm93c2VyIGNvbnNvbGUsIHR5cGUgYGVuYWJsZUxvZ2dpbmcoKWAgdG8gZW5hYmxlIGxvZ2dpbmcuXG5cdFx0ICogVXNhZ2U6IEluIHRoZSBicm93c2VyIGNvbnNvbGUsIHR5cGUgYGRpc2FibGVMb2dnaW5nKClgIHRvIGRpc2FibGUgbG9nZ2luZy5cblx0XHQgKi9cblx0XHRcblx0XHQod2luZG93IGFzIGFueSkuZW5hYmxlTG9nZ2luZyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0TG9nZ2VyLmVuYWJsZSgpO1xuXHRcdFx0Y29uc29sZS5sb2coXCJMb2dnaW5nIGVuYWJsZWRcIik7XG5cdFx0fTtcblx0XHQod2luZG93IGFzIGFueSkuZGlzYWJsZUxvZ2dpbmcgPSBmdW5jdGlvbigpIHtcblx0XHRcdExvZ2dlci5kaXNhYmxlKCk7XG5cdFx0XHRjb25zb2xlLmxvZyhcIkxvZ2dpbmcgZGlzYWJsZWRcIik7XG5cdFx0fTtcblx0fVxuXG5cdG9udW5sb2FkKCkge1xuXHRcdHRoaXMuY29hbGVzY2VNYW5hZ2VyLmNsZWFyQmFja2xpbmtzKCk7XG5cdH1cblxuXHRwcml2YXRlIGlzRGFpbHlOb3RlKGZpbGU6IFRGaWxlKTogYm9vbGVhbiB7XG5cdFx0Ly8gQWNjZXNzIHRoZSBEYWlseSBOb3RlcyBjb3JlIHBsdWdpblxuXHRcdGNvbnN0IGRhaWx5Tm90ZXNQbHVnaW4gPSAodGhpcy5hcHAgYXMgYW55KS5pbnRlcm5hbFBsdWdpbnMucGx1Z2luc1snZGFpbHktbm90ZXMnXTtcblx0XHRpZiAoIWRhaWx5Tm90ZXNQbHVnaW4gfHwgIWRhaWx5Tm90ZXNQbHVnaW4uZW5hYmxlZCkge1xuXHRcdFx0dGhpcy5sb2dnZXIuZGVidWcoJ0RhaWx5IE5vdGVzIHBsdWdpbiBpcyBub3QgZW5hYmxlZC4nKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBSZXRyaWV2ZSB0aGUgZGFpbHkgbm90ZXMgZm9sZGVyIGZyb20gdGhlIHBsdWdpbidzIHNldHRpbmdzXG5cdFx0Y29uc3QgZGFpbHlOb3Rlc0ZvbGRlciA9IGRhaWx5Tm90ZXNQbHVnaW4uaW5zdGFuY2Uub3B0aW9ucy5mb2xkZXIgfHwgJyc7XG5cdFx0aWYgKCFkYWlseU5vdGVzRm9sZGVyKSB7XG5cdFx0XHR0aGlzLmxvZ2dlci5kZWJ1ZyhcIkRhaWx5IE5vdGVzIGZvbGRlciBub3Qgc2V0LCB1c2luZyB2YXVsdCByb290LlwiKTtcblx0XHR9XG5cblx0XHRjb25zdCBkYWlseU5vdGVQYXR0ZXJuID0gL15cXGR7NH0tXFxkezJ9LVxcZHsyfVxcLm1kJC87IC8vIEFkanVzdCB0aGlzIHBhdHRlcm4gaWYgbmVlZGVkXG5cblx0XHQvLyBDaGVjayBpZiB0aGUgZmlsZSBpcyBpbiB0aGUgZGFpbHkgbm90ZXMgZm9sZGVyXG5cdFx0aWYgKCFmaWxlLnBhdGguc3RhcnRzV2l0aChkYWlseU5vdGVzRm9sZGVyKSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIENoZWNrIGlmIHRoZSBmaWxlIG5hbWUgbWF0Y2hlcyB0aGUgZGFpbHkgbm90ZSBwYXR0ZXJuXG5cdFx0cmV0dXJuIGRhaWx5Tm90ZVBhdHRlcm4udGVzdChmaWxlLm5hbWUpO1xuXHR9XG59IiwgImludGVyZmFjZSBDb2FsZXNjZVBsdWdpblNldHRpbmdzIHtcbiAgICBteVNldHRpbmc6IHN0cmluZztcbiAgICBzb3J0RGVzY2VuZGluZzogYm9vbGVhbjtcbiAgICBibG9ja3NDb2xsYXBzZWQ6IGJvb2xlYW47XG4gICAgc2hvd0luRGFpbHlOb3RlczogYm9vbGVhbjtcbiAgICBibG9ja0JvdW5kYXJ5U3RyYXRlZ3k6IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQ29hbGVzY2VQbHVnaW5TZXR0aW5ncyA9IHtcbiAgICBteVNldHRpbmc6ICdkZWZhdWx0JyxcbiAgICBzb3J0RGVzY2VuZGluZzogdHJ1ZSxcbiAgICBibG9ja3NDb2xsYXBzZWQ6IHRydWUsXG4gICAgc2hvd0luRGFpbHlOb3RlczogZmFsc2UsXG4gICAgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5OiAnZGVmYXVsdCdcbn07XG5cbmludGVyZmFjZSBQbHVnaW4ge1xuICAgIGxvYWREYXRhKCk6IFByb21pc2U8UGFydGlhbDxDb2FsZXNjZVBsdWdpblNldHRpbmdzPj47XG4gICAgc2F2ZURhdGEoc2V0dGluZ3M6IENvYWxlc2NlUGx1Z2luU2V0dGluZ3MpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5jbGFzcyBQbHVnaW4ge1xuICAgIGFzeW5jIGxvYWREYXRhKCk6IFByb21pc2U8UGFydGlhbDxDb2FsZXNjZVBsdWdpblNldHRpbmdzPj4ge1xuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZURhdGEoc2V0dGluZ3M6IENvYWxlc2NlUGx1Z2luU2V0dGluZ3MpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTZXR0aW5nc01hbmFnZXIge1xuICAgIHByaXZhdGUgcGx1Z2luOiBQbHVnaW47XG4gICAgc2V0dGluZ3M6IENvYWxlc2NlUGx1Z2luU2V0dGluZ3M7XG5cbiAgICBjb25zdHJ1Y3RvcihwbHVnaW46IFBsdWdpbikge1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLnBsdWdpbi5sb2FkRGF0YSgpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1hcmtkb3duVmlldywgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBDb2FsZXNjZVZpZXcgfSBmcm9tICcuL0NvYWxlc2NlVmlldyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuL0xvZ2dlcic7XG5pbXBvcnQgeyBTZXR0aW5nc01hbmFnZXIgfSBmcm9tICcuL1NldHRpbmdzTWFuYWdlcic7XG5pbXBvcnQgeyBEZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5IH0gZnJvbSAnLi9EZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5JztcbmltcG9ydCB7IFNpbmdsZUxpbmVCbG9ja0JvdW5kYXJ5U3RyYXRlZ3kgfSBmcm9tICcuL1NpbmdsZUxpbmVCbG9ja0JvdW5kYXJ5U3RyYXRlZ3knO1xuXG5leHBvcnQgY2xhc3MgQ29hbGVzY2VNYW5hZ2VyIHtcbiAgICBwcml2YXRlIGNvYWxlc2NlVmlldzogQ29hbGVzY2VWaWV3IHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBsb2dnZXI6IExvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwOiBBcHAsIHByaXZhdGUgc2V0dGluZ3NNYW5hZ2VyOiBTZXR0aW5nc01hbmFnZXIpIHt9XG5cbiAgICBoYW5kbGVGaWxlT3BlbihmaWxlOiBURmlsZSkge1xuICAgICAgICBpZiAoIWZpbGUpIHJldHVybjtcblxuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCF2aWV3KSByZXR1cm47XG5cbiAgICAgICAgaWYgKHRoaXMuY29hbGVzY2VWaWV3KSB7XG4gICAgICAgICAgICB0aGlzLmNvYWxlc2NlVmlldy5jbGVhcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudE5vdGVOYW1lID0gZmlsZS5iYXNlbmFtZTtcbiAgICAgICAgY29uc3QgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneUZyb21TZXR0aW5ncygpO1xuICAgICAgICB0aGlzLmNvYWxlc2NlVmlldyA9IG5ldyBDb2FsZXNjZVZpZXcodmlldywgY3VycmVudE5vdGVOYW1lLCB0aGlzLnNldHRpbmdzTWFuYWdlciwgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5KTtcblxuICAgICAgICBjb25zdCBiYWNrbGlua3MgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLnJlc29sdmVkTGlua3M7XG4gICAgICAgIGNvbnN0IGZpbGVzTGlua2luZ1RvVGhpcyA9IE9iamVjdC5lbnRyaWVzKGJhY2tsaW5rcylcbiAgICAgICAgICAgIC5maWx0ZXIoKFtfLCBsaW5rc10pID0+IGZpbGUucGF0aCBpbiAobGlua3MgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pKVxuICAgICAgICAgICAgLm1hcCgoW3NvdXJjZVBhdGhdKSA9PiBzb3VyY2VQYXRoKTtcblxuICAgICAgICB0aGlzLmNvYWxlc2NlVmlldy51cGRhdGVCYWNrbGlua3MoZmlsZXNMaW5raW5nVG9UaGlzLCAocGF0aCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9wZW5MaW5rVGV4dChwYXRoLCAnJywgZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFN0cmF0ZWd5RnJvbVNldHRpbmdzKCkge1xuICAgICAgICBjb25zdCBibG9ja0JvdW5kYXJ5U3RyYXRlZ3kgPSB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5ibG9ja0JvdW5kYXJ5U3RyYXRlZ3k7XG4gICAgICAgIHN3aXRjaCAoYmxvY2tCb3VuZGFyeVN0cmF0ZWd5KSB7XG4gICAgICAgICAgICBjYXNlICdzaW5nbGUtbGluZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5KCk7XG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGVhckJhY2tsaW5rcygpIHtcbiAgICAgICAgaWYgKHRoaXMuY29hbGVzY2VWaWV3KSB7XG4gICAgICAgICAgICB0aGlzLmNvYWxlc2NlVmlldy5jbGVhcigpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwgImltcG9ydCB7IE1hcmtkb3duVmlldywgVEZpbGUsIE1hcmtkb3duUmVuZGVyZXIgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBCbG9ja0NvbXBvbmVudCB9IGZyb20gJy4vQmxvY2tDb21wb25lbnQnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi9Mb2dnZXInO1xuaW1wb3J0IHsgSGVhZGVyQ29tcG9uZW50IH0gZnJvbSAnLi9IZWFkZXJDb21wb25lbnQnO1xuaW1wb3J0IHsgU2V0dGluZ3NNYW5hZ2VyIH0gZnJvbSAnLi9TZXR0aW5nc01hbmFnZXInO1xuaW1wb3J0IHsgQmxvY2tCb3VuZGFyeVN0cmF0ZWd5IH0gZnJvbSAnLi9CbG9ja0JvdW5kYXJ5U3RyYXRlZ3knO1xuaW1wb3J0IHsgRGVmYXVsdEJsb2NrQm91bmRhcnlTdHJhdGVneSB9IGZyb20gJy4vRGVmYXVsdEJsb2NrQm91bmRhcnlTdHJhdGVneSc7XG5pbXBvcnQgeyBTaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5IH0gZnJvbSAnLi9TaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5JztcblxuZXhwb3J0IGNsYXNzIENvYWxlc2NlVmlldyB7XG4gICAgcHJpdmF0ZSBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgY3VycmVudE5vdGVOYW1lOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBsb2dnZXI6IExvZ2dlciA9IG5ldyBMb2dnZXIoKTtcbiAgICBwcml2YXRlIGhlYWRlckNvbXBvbmVudDogSGVhZGVyQ29tcG9uZW50ID0gbmV3IEhlYWRlckNvbXBvbmVudCgpO1xuICAgIHByaXZhdGUgc29ydERlc2NlbmRpbmc6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBibG9ja3NDb2xsYXBzZWQ6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBhbGxCbG9ja3M6IHsgYmxvY2s6IEJsb2NrQ29tcG9uZW50OyBzb3VyY2VQYXRoOiBzdHJpbmcgfVtdID0gW107XG4gICAgcHJpdmF0ZSBibG9ja0JvdW5kYXJ5U3RyYXRlZ3k6IEJsb2NrQm91bmRhcnlTdHJhdGVneTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHZpZXc6IE1hcmtkb3duVmlldyxcbiAgICAgICAgY3VycmVudE5vdGVOYW1lOiBzdHJpbmcsXG4gICAgICAgIHByaXZhdGUgc2V0dGluZ3NNYW5hZ2VyOiBTZXR0aW5nc01hbmFnZXIsXG4gICAgICAgIGJsb2NrQm91bmRhcnlTdHJhdGVneTogQmxvY2tCb3VuZGFyeVN0cmF0ZWd5LFxuICAgICkge1xuICAgICAgICB0aGlzLmN1cnJlbnROb3RlTmFtZSA9IGN1cnJlbnROb3RlTmFtZTtcbiAgICAgICAgdGhpcy5ibG9ja0JvdW5kYXJ5U3RyYXRlZ3kgPSBibG9ja0JvdW5kYXJ5U3RyYXRlZ3k7XG4gICAgICAgIHRoaXMuc29ydERlc2NlbmRpbmcgPSB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5zb3J0RGVzY2VuZGluZztcbiAgICAgICAgdGhpcy5ibG9ja3NDb2xsYXBzZWQgPSB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5ibG9ja3NDb2xsYXBzZWQ7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5jcmVhdGVCYWNrbGlua3NDb250YWluZXIoKTtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkFwcGVuZGluZyBiYWNrbGlua3MgY29udGFpbmVyIHRvIHRoZSB2aWV3XCIpO1xuXG4gICAgICAgIC8vIEFwcGVuZCB0aGUgY29udGFpbmVyIGRpcmVjdGx5IHRvIHRoZSBtYXJrZG93biB2aWV3J3MgY29udGVudCBhcmVhXG4gICAgICAgIGNvbnN0IG1hcmtkb3duQ29udGVudCA9IHRoaXMudmlldy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKCcubWFya2Rvd24tcHJldmlldy12aWV3JykgYXMgSFRNTEVsZW1lbnQgfHwgdGhpcy52aWV3LmNvbnRlbnRFbCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgaWYgKG1hcmtkb3duQ29udGVudCkge1xuICAgICAgICAgICAgbWFya2Rvd25Db250ZW50LmNsYXNzTGlzdC5hZGQoJ21hcmtkb3duLWNvbnRlbnQnKTtcbiAgICAgICAgICAgIG1hcmtkb3duQ29udGVudC5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcik7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXCJNYXJrZG93biBjb250ZW50IGFyZWEgbm90IGZvdW5kLlwiKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlQmFja2xpbmtzQ29udGFpbmVyKCk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdjdXN0b20tYmFja2xpbmtzLWNvbnRhaW5lcicpO1xuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgZ2V0QmxvY2tEYXRhKGZpbGVQYXRoOiBzdHJpbmcsIGN1cnJlbnROb3RlTmFtZTogc3RyaW5nKTogUHJvbWlzZTxCbG9ja0NvbXBvbmVudFtdPiB7XG4gICAgICAgIGNvbnN0IGJsb2NrczogQmxvY2tDb21wb25lbnRbXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLnZpZXcuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChmaWxlICYmIGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLnZpZXcuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgYm91bmRhcmllcyA9IHRoaXMuYmxvY2tCb3VuZGFyeVN0cmF0ZWd5LmZpbmRCbG9ja0JvdW5kYXJpZXMoY29udGVudCwgY3VycmVudE5vdGVOYW1lKTtcblxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgeyBzdGFydCwgZW5kIH0gb2YgYm91bmRhcmllcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9ja0NvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhzdGFydCwgZW5kKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvY2sgPSBuZXcgQmxvY2tDb21wb25lbnQoYmxvY2tDb250ZW50LCBmaWxlUGF0aCwgY3VycmVudE5vdGVOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzLnB1c2goYmxvY2spO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHJlYWRpbmcgZmlsZSBjb250ZW50IGZvciAke2ZpbGVQYXRofTpgLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJsb2NrcztcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZUJsb2NrQm91bmRhcnlTdHJhdGVneShzdHJhdGVneTogc3RyaW5nKSB7XG4gICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHtcbiAgICAgICAgICAgIGNhc2UgJ3NpbmdsZS1saW5lJzpcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrQm91bmRhcnlTdHJhdGVneSA9IG5ldyBTaW5nbGVMaW5lQmxvY2tCb3VuZGFyeVN0cmF0ZWd5KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5ibG9ja0JvdW5kYXJ5U3RyYXRlZ3kgPSBuZXcgRGVmYXVsdEJsb2NrQm91bmRhcnlTdHJhdGVneSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHVwZGF0ZUJhY2tsaW5rcyhmaWxlc0xpbmtpbmdUb1RoaXM6IHN0cmluZ1tdLCBvbkxpbmtDbGljazogKHBhdGg6IHN0cmluZykgPT4gdm9pZCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiVXBkYXRpbmcgYmFja2xpbmtzOlwiLCBmaWxlc0xpbmtpbmdUb1RoaXMpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgICAgIGNvbnN0IGxpbmtzQ29udGFpbmVyID0gdGhpcy5jb250YWluZXIuY3JlYXRlRGl2KCdiYWNrbGlua3MtbGlzdCcpO1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiTGlua3MgY29udGFpbmVyOlwiLCBsaW5rc0NvbnRhaW5lcik7XG5cbiAgICAgICAgdGhpcy5hbGxCbG9ja3MgPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIENvbGxlY3QgYWxsIGJsb2NrcyBmaXJzdFxuICAgICAgICBmb3IgKGNvbnN0IHNvdXJjZVBhdGggb2YgZmlsZXNMaW5raW5nVG9UaGlzKSB7XG4gICAgICAgICAgICBjb25zdCBibG9ja3MgPSBhd2FpdCB0aGlzLmdldEJsb2NrRGF0YShzb3VyY2VQYXRoLCB0aGlzLmN1cnJlbnROb3RlTmFtZSk7XG4gICAgICAgICAgICBibG9ja3MuZm9yRWFjaChibG9jayA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGxCbG9ja3MucHVzaCh7IGJsb2NrLCBzb3VyY2VQYXRoIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTb3J0IGJsb2Nrc1xuICAgICAgICB0aGlzLmFsbEJsb2Nrcy5zb3J0KChhLCBiKSA9PiB0aGlzLnNvcnREZXNjZW5kaW5nIFxuICAgICAgICAgICAgPyBiLnNvdXJjZVBhdGgubG9jYWxlQ29tcGFyZShhLnNvdXJjZVBhdGgpXG4gICAgICAgICAgICA6IGEuc291cmNlUGF0aC5sb2NhbGVDb21wYXJlKGIuc291cmNlUGF0aCkpO1xuXG4gICAgICAgIC8vIFJlbmRlciBibG9ja3Mgd2l0aCBjb3JyZWN0IGluaXRpYWwgc3RhdGVcbiAgICAgICAgZm9yIChjb25zdCB7IGJsb2NrIH0gb2YgdGhpcy5hbGxCbG9ja3MpIHtcbiAgICAgICAgICAgIGF3YWl0IGJsb2NrLnJlbmRlcihsaW5rc0NvbnRhaW5lciwgdGhpcy52aWV3LCBvbkxpbmtDbGljayk7XG4gICAgICAgICAgICBjb25zdCBibG9ja0NvbnRhaW5lciA9IGJsb2NrLmdldENvbnRhaW5lcigpO1xuICAgICAgICAgICAgYmxvY2tDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IHRoaXMuYmxvY2tzQ29sbGFwc2VkID8gJ25vbmUnIDogJ2Jsb2NrJztcbiAgICAgICAgICAgIGJsb2NrLnNldEFycm93U3RhdGUoIXRoaXMuYmxvY2tzQ29sbGFwc2VkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBoZWFkZXIgYWZ0ZXIgYmxvY2tzIGFyZSByZW5kZXJlZFxuICAgICAgICBjb25zdCBjcmVhdGVIZWFkZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oZWFkZXJDb21wb25lbnQuY3JlYXRlSGVhZGVyKFxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLCBcbiAgICAgICAgICAgICAgICBmaWxlc0xpbmtpbmdUb1RoaXMubGVuZ3RoLCBcbiAgICAgICAgICAgICAgICB0aGlzLmFsbEJsb2Nrcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0RGVzY2VuZGluZyxcbiAgICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlU29ydCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUJhY2tsaW5rcyhmaWxlc0xpbmtpbmdUb1RoaXMsIG9uTGlua0NsaWNrKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVBbGxCbG9ja3MoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkSGVhZGVyID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignLmJhY2tsaW5rcy1oZWFkZXInKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZEhlYWRlciAmJiB0aGlzLmNvbnRhaW5lci5jb250YWlucyhvbGRIZWFkZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdIZWFkZXIgPSBjcmVhdGVIZWFkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlcGxhY2VDaGlsZChuZXdIZWFkZXIsIG9sZEhlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tzQ29sbGFwc2VkLFxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldHRpbmdzLmJsb2NrQm91bmRhcnlTdHJhdGVneSxcbiAgICAgICAgICAgICAgICBhc3luYyAoc3RyYXRlZ3kpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0dGluZ3MuYmxvY2tCb3VuZGFyeVN0cmF0ZWd5ID0gc3RyYXRlZ3k7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHN0cmF0ZWd5IGJlZm9yZSByZWxvYWRpbmdcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCbG9ja0JvdW5kYXJ5U3RyYXRlZ3koc3RyYXRlZ3kpO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZWxvYWQgdGhlIGNvbnRlbnRzIGFuZCBibG9ja3NcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVCYWNrbGlua3MoZmlsZXNMaW5raW5nVG9UaGlzLCBvbkxpbmtDbGljayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBoZWFkZXIgPSBjcmVhdGVIZWFkZXIoKTtcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoaGVhZGVyKTtcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQobGlua3NDb250YWluZXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyB0b2dnbGVTb3J0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNvcnREZXNjZW5kaW5nID0gIXRoaXMuc29ydERlc2NlbmRpbmc7XG4gICAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldHRpbmdzLnNvcnREZXNjZW5kaW5nID0gdGhpcy5zb3J0RGVzY2VuZGluZztcbiAgICAgICAgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2F2ZVNldHRpbmdzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0b2dnbGVBbGxCbG9ja3MoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYmxvY2tzQ29sbGFwc2VkID0gIXRoaXMuYmxvY2tzQ29sbGFwc2VkO1xuICAgICAgICB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5ibG9ja3NDb2xsYXBzZWQgPSB0aGlzLmJsb2Nrc0NvbGxhcHNlZDtcbiAgICAgICAgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2F2ZVNldHRpbmdzKCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGFsbCBibG9ja3MgYmFzZWQgb24gdGhlIG5ldyBzdGF0ZVxuICAgICAgICB0aGlzLmFsbEJsb2Nrcy5mb3JFYWNoKCh7IGJsb2NrIH0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2NrQ29udGFpbmVyID0gYmxvY2suZ2V0Q29udGFpbmVyKCk7XG4gICAgICAgICAgICBibG9ja0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gdGhpcy5ibG9ja3NDb2xsYXBzZWQgPyAnbm9uZScgOiAnYmxvY2snO1xuICAgICAgICAgICAgYmxvY2suc2V0QXJyb3dTdGF0ZSghdGhpcy5ibG9ja3NDb2xsYXBzZWQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjbGVhcigpIHtcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBjb250YWluZXIgZnJvbSB0aGUgRE9NIHRvdGFsbHlcbiAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyLnBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJCYWNrbGlua3MgdmlldyBjbGVhcmVkXCIpO1xuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBNYXJrZG93blJlbmRlcmVyLCBNYXJrZG93blZpZXcgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vTG9nZ2VyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBCbG9ja0NvbXBvbmVudCB7XHJcbiAgICBwcml2YXRlIGJsb2NrQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgdG9nZ2xlQnV0dG9uOiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgbG9nZ2VyOiBMb2dnZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIGNvbnRlbnRzOiBzdHJpbmcsXHJcbiAgICAgICAgcHVibGljIGZpbGVQYXRoOiBzdHJpbmcsXHJcbiAgICAgICAgcHVibGljIG5vdGVOYW1lOiBzdHJpbmdcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMubG9nZ2VyID0gbmV3IExvZ2dlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHJlbmRlcihjb250YWluZXI6IEhUTUxFbGVtZW50LCB2aWV3OiBNYXJrZG93blZpZXcsIG9uTGlua0NsaWNrOiAocGF0aDogc3RyaW5nKSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgY29uc3QgZGlzcGxheVRleHQgPSB0aGlzLmZpbGVQYXRoLnJlcGxhY2UoL1xcLm1kJC8sICcnKTtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgZGlzcGxheSB0ZXh0IGFuZCB0b2dnbGUgYnV0dG9uXHJcbiAgICAgICAgY29uc3QgaGVhZGVyQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ2Jsb2NrLWhlYWRlcicgfSk7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgdG9nZ2xlIGJ1dHRvblxyXG4gICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uID0gaGVhZGVyQ29udGFpbmVyLmNyZWF0ZUVsKCdzcGFuJywge1xyXG4gICAgICAgICAgICBjbHM6ICd0b2dnbGUtYXJyb3cnLFxyXG4gICAgICAgICAgICB0ZXh0OiAnXHUyNUJDJywgLy8gRG93bi1wb2ludGluZyBhcnJvdyBmb3Igb3BlbiBzdGF0ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBCbG9jayBoZWFkZXJcclxuICAgICAgICBjb25zdCBibG9ja1RpdGxlID0gaGVhZGVyQ29udGFpbmVyLmNyZWF0ZUVsKCdhJywge1xyXG4gICAgICAgICAgICB0ZXh0OiBkaXNwbGF5VGV4dCxcclxuICAgICAgICAgICAgY2xzOiAnYmxvY2stdGl0bGUnLFxyXG4gICAgICAgICAgICBocmVmOiAnIycsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYmxvY2tUaXRsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBvbkxpbmtDbGljayh0aGlzLmZpbGVQYXRoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIGEgYmxvY2sgY29udGFpbmVyIHdpdGggdGhlIGNsYXNzICdiYWNrbGluay1pdGVtJ1xyXG4gICAgICAgIGNvbnN0IGJsb2NrQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ2JhY2tsaW5rLWl0ZW0nIH0pO1xyXG5cclxuICAgICAgICAvLyBSZW5kZXIgdGhlIG1hcmtkb3duIGNvbnRlbnRcclxuICAgICAgICBjb25zdCBjb250ZW50UHJldmlldyA9IGJsb2NrQ29udGFpbmVyLmNyZWF0ZURpdignY29udGVudC1wcmV2aWV3Jyk7XHJcblxyXG4gICAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyKFxyXG4gICAgICAgICAgICB2aWV3LmFwcCxcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50cyxcclxuICAgICAgICAgICAgY29udGVudFByZXZpZXcsXHJcbiAgICAgICAgICAgIHRoaXMuZmlsZVBhdGgsXHJcbiAgICAgICAgICAgIHZpZXcsXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy8gQWRkIGNsaWNrIGhhbmRsZXJzIGZvciBpbnRlcm5hbCBsaW5rcywgd2l0aG91dCBkZWJ1ZyBsb2dnaW5nXHJcbiAgICAgICAgY29udGVudFByZXZpZXcucXVlcnlTZWxlY3RvckFsbCgnYS5pbnRlcm5hbC1saW5rJykuZm9yRWFjaCgobGluazogSFRNTEVsZW1lbnQpID0+IHtcclxuICAgICAgICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkxpbmsgY2xpY2tlZCFcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhyZWYgPSBsaW5rLmdldEF0dHJpYnV0ZSgnaHJlZicpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGhyZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWNvZGVkUGF0aCA9IGRlY29kZVVSSShocmVmKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgY2FudmFzIGZpbGUgZmlyc3QsIG90aGVyd2lzZSBoYW5kbGUgYXMgbWFya2Rvd25cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdWxsUGF0aCA9IGRlY29kZWRQYXRoLmVuZHNXaXRoKCcuY2FudmFzJykgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZGVjb2RlZFBhdGggXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogZGVjb2RlZFBhdGguZW5kc1dpdGgoJy5tZCcpIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBkZWNvZGVkUGF0aCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogYCR7ZGVjb2RlZFBhdGh9Lm1kYDtcclxuICAgICAgICAgICAgICAgICAgICBvbkxpbmtDbGljayhmdWxsUGF0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBJbml0aWFsbHkgc2hvdyB0aGUgZW50aXJlIGJsb2NrIGNvbnRhaW5lclxyXG4gICAgICAgIGJsb2NrQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG5cclxuICAgICAgICAvLyBTaG93L2hpZGUgYSBzaW5nbGUgYmxvY2tcclxuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaXNDb2xsYXBzZWQgPSBibG9ja0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZSc7XHJcbiAgICAgICAgICAgIGJsb2NrQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBpc0NvbGxhcHNlZCA/ICdibG9jaycgOiAnbm9uZSc7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uLnRleHRDb250ZW50ID0gaXNDb2xsYXBzZWQgPyAnXHUyNUJDJyA6ICdcdTI1QjYnOyAvLyBUb2dnbGUgYXJyb3cgZGlyZWN0aW9uXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuYmxvY2tDb250YWluZXIgPSBibG9ja0NvbnRhaW5lcjsgLy8gU2F2ZSB0aGUgcmVmZXJlbmNlXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29udGFpbmVyKCk6IEhUTUxFbGVtZW50IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ibG9ja0NvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXRBcnJvd1N0YXRlKGlzRXhwYW5kZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy50b2dnbGVCdXR0b24pIHtcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVCdXR0b24udGV4dENvbnRlbnQgPSBpc0V4cGFuZGVkID8gJ1x1MjVCQycgOiAnXHUyNUI2JztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwgImV4cG9ydCBjbGFzcyBMb2dnZXIge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZW5hYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIHN0YXRpYyBlbmFibGUoKSB7XHJcbiAgICAgICAgTG9nZ2VyLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBkaXNhYmxlKCkge1xyXG4gICAgICAgIExvZ2dlci5lbmFibGVkID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaW5mbyhtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pIHtcclxuICAgICAgICBpZiAoTG9nZ2VyLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3YXJuKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChMb2dnZXIuZW5hYmxlZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4obWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkZWJ1ZyhtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pIHtcclxuICAgICAgICBpZiAoTG9nZ2VyLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhtZXNzYWdlLCAuLi5vcHRpb25hbFBhcmFtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwgImV4cG9ydCBjbGFzcyBIZWFkZXJDb21wb25lbnQge1xuICAgIGNyZWF0ZUhlYWRlcihcbiAgICAgICAgY29udGFpbmVyOiBIVE1MRWxlbWVudCwgXG4gICAgICAgIGZpbGVDb3VudDogbnVtYmVyLCBcbiAgICAgICAgYmxvY2tDb3VudDogbnVtYmVyLFxuICAgICAgICBzb3J0RGVzY2VuZGluZzogYm9vbGVhbixcbiAgICAgICAgb25Tb3J0VG9nZ2xlOiAoKSA9PiB2b2lkLFxuICAgICAgICBvbkNvbGxhcHNlVG9nZ2xlOiAoKSA9PiB2b2lkLFxuICAgICAgICBpc0NvbGxhcHNlZDogYm9vbGVhbixcbiAgICAgICAgY3VycmVudFN0cmF0ZWd5OiBzdHJpbmcsXG4gICAgICAgIG9uU3RyYXRlZ3lDaGFuZ2U6IChzdHJhdGVneTogc3RyaW5nKSA9PiB2b2lkXG4gICAgKTogSFRNTEVsZW1lbnQge1xuICAgICAgICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFkZCBjb2FsZXNjZSBpY29uXG4gICAgICAgIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwic3ZnXCIpO1xuICAgICAgICBzdmcuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgMCAxMDAgMTAwXCIpO1xuICAgICAgICBzdmcuc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgXCIxOFwiKTtcbiAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBcIjE4XCIpO1xuICAgICAgICBzdmcuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBcImN1cnJlbnRDb2xvclwiKTtcbiAgICAgICAgc3ZnLmlubmVySFRNTCA9IGA8cGF0aCBkPVwiTTg1IDQwLjVDODUgMjIuNSA3MC41IDEwIDUyLjUgMTBjLTI3LjYgMC00My4xIDI0LjUtNDMuMSA0MCAwIDIxLjcgMTYuOCA0MCA0Mi42IDQwIDExLjMgMCAyMS4xLTIuOCAyNy40LTYuNSAyLjItMS4zIDMuNi0yLjggMy42LTQuNCAwLTEuMy0wLjktMi40LTIuMi0yLjQtMC42IDAtMS4yIDAuMi0yIDAuNy02LjggNC44LTE1LjkgNy4xLTI2LjggNy4xLTIyLjMgMC0zNi4yLTE1LjQtMzYuMi0zNC41IDAtMTkuMSAxMy45LTM0LjUgMzYuMi0zNC41IDE1LjQgMCAyNy41IDEwLjMgMjcuNSAyNC41IDAgMTEuOC03LjggMTkuNS0xNi44IDE5LjUtNC45IDAtNy44LTIuNS03LjgtNi43IDAtMS4xIDAuMi0yLjMgMC41LTMuNGw0LjEtMTYuOGMwLjktMy43LTEuMS01LjYtNC01LjYtNC45IDAtOS42IDUtOS42IDEyLjMgMCA1LjYgMy4xIDkuNSA5LjMgOS41IDQuNyAwIDkuMS0xLjkgMTIuNC01LjQgMy4zIDMuNSA4LjIgNS40IDE0LjMgNS40QzczLjIgNjAgODUgNTEuNSA4NSA0MC41elwiLz5gO1xuICAgICAgICBoZWFkZXIuYXBwZW5kQ2hpbGQoc3ZnKTtcblxuICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LmFkZCgnYmFja2xpbmtzLWhlYWRlcicpO1xuXG4gICAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICB0aXRsZS5jbGFzc0xpc3QuYWRkKCdoZWFkZXItdGl0bGUnKTtcbiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSBgJHtmaWxlQ291bnR9ICR7ZmlsZUNvdW50ID09PSAxID8gJ0JhY2tsaW5rJyA6ICdCYWNrbGlua3MnfSwgJHtibG9ja0NvdW50fSAke2Jsb2NrQ291bnQgPT09IDEgPyAnQmxvY2snIDogJ0Jsb2Nrcyd9YDtcbiAgICAgICAgaGVhZGVyLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIGFkZCBzb3J0IGljb25cbiAgICAgICAgY29uc3Qgc29ydEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBzb3J0QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NsaWNrYWJsZS1pY29uJywgJ3NvcnQtYnV0dG9uJyk7XG4gICAgICAgIHNvcnRCdXR0b24uaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPHN2ZyB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCIgc3R5bGU9XCJ0cmFuc2Zvcm06ICR7c29ydERlc2NlbmRpbmcgPyAnbm9uZScgOiAncm90YXRlKDE4MGRlZyknfVwiPlxuICAgICAgICAgICAgICAgIDxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTQgNGw0IDQgNC00SDR6XCIvPlxuICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgIGA7XG4gICAgICAgIHNvcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvblNvcnRUb2dnbGUpO1xuICAgICAgICBoZWFkZXIuYXBwZW5kQ2hpbGQoc29ydEJ1dHRvbik7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGFuZCBhZGQgY29sbGFwc2UvZXhwYW5kIGFsbCBpY29uXG4gICAgICAgIGNvbnN0IGNvbGxhcHNlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIGNvbGxhcHNlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NsaWNrYWJsZS1pY29uJywgJ2NvbGxhcHNlLWJ1dHRvbicpO1xuICAgICAgICBjb2xsYXBzZUJ1dHRvbi5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8c3ZnIHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCIxNlwiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIiBzdHlsZT1cInRyYW5zZm9ybTogJHtpc0NvbGxhcHNlZCA/ICdyb3RhdGUoLTkwZGVnKScgOiAnbm9uZSd9XCI+XG4gICAgICAgICAgICAgICAgPHBhdGggZmlsbD1cImN1cnJlbnRDb2xvclwiIGQ9XCJNNCA0bDQgNCA0LTRINHpcIi8+XG4gICAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgYDtcbiAgICAgICAgY29sbGFwc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNvbGxhcHNlVG9nZ2xlKTtcbiAgICAgICAgaGVhZGVyLmFwcGVuZENoaWxkKGNvbGxhcHNlQnV0dG9uKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBhbmQgYWRkIGJsb2NrQm91bmRhcnlTdHJhdGVneVNlbGVjdCBkcm9wZG93blxuICAgICAgICBjb25zdCBibG9ja0JvdW5kYXJ5U3RyYXRlZ3lTZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTtcbiAgICAgICAgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5U2VsZWN0LmNsYXNzTGlzdC5hZGQoJ3N0cmF0ZWd5LXNlbGVjdCcpO1xuICAgICAgICBjb25zdCBibG9ja0JvdW5kYXJ5U3RyYXRlZ2llcyA9IFsnZGVmYXVsdCcsICdzaW5nbGUtbGluZSddO1xuICAgICAgICBibG9ja0JvdW5kYXJ5U3RyYXRlZ2llcy5mb3JFYWNoKHN0cmF0ZWd5ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gc3RyYXRlZ3k7XG4gICAgICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBzdHJhdGVneS5yZXBsYWNlKCctJywgJyAnKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gc3RyYXRlZ3kgPT09IGN1cnJlbnRTdHJhdGVneTtcbiAgICAgICAgICAgIGJsb2NrQm91bmRhcnlTdHJhdGVneVNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pO1xuICAgICAgICB9KTtcbiAgICAgICAgYmxvY2tCb3VuZGFyeVN0cmF0ZWd5U2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgIG9uU3RyYXRlZ3lDaGFuZ2UoYmxvY2tCb3VuZGFyeVN0cmF0ZWd5U2VsZWN0LnZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGhlYWRlci5hcHBlbmRDaGlsZChibG9ja0JvdW5kYXJ5U3RyYXRlZ3lTZWxlY3QpO1xuXG4gICAgICAgIHJldHVybiBoZWFkZXI7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IEJsb2NrQm91bmRhcnlTdHJhdGVneSB9IGZyb20gJy4vQmxvY2tCb3VuZGFyeVN0cmF0ZWd5JztcclxuXHJcbmV4cG9ydCBjbGFzcyBEZWZhdWx0QmxvY2tCb3VuZGFyeVN0cmF0ZWd5IGltcGxlbWVudHMgQmxvY2tCb3VuZGFyeVN0cmF0ZWd5IHtcclxuICAgIGZpbmRCbG9ja0JvdW5kYXJpZXMoY29udGVudDogc3RyaW5nLCBjdXJyZW50Tm90ZU5hbWU6IHN0cmluZyk6IHsgc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIgfVtdIHtcclxuICAgICAgICBjb25zdCBib3VuZGFyaWVzOiB7IHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyIH1bXSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgXFxcXFtcXFxcWyR7Y3VycmVudE5vdGVOYW1lfVxcXFxdXFxcXF1gLCAnZycpO1xyXG4gICAgICAgIGxldCBtYXRjaDtcclxuXHJcbiAgICAgICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWMoY29udGVudCkpICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmVTdGFydEluZGV4ID0gY29udGVudC5sYXN0SW5kZXhPZignXFxuJywgbWF0Y2guaW5kZXgpICsgMTtcclxuICAgICAgICAgICAgY29uc3QgZW5kSW5kZXggPSBjb250ZW50LmluZGV4T2YoJy0tLScsIG1hdGNoLmluZGV4KTtcclxuICAgICAgICAgICAgY29uc3QgbmV4dE1lbnRpb25JbmRleCA9IGNvbnRlbnQuaW5kZXhPZihgW1ske2N1cnJlbnROb3RlTmFtZX1dXWAsIG1hdGNoLmluZGV4ICsgMSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgYmxvY2tFbmRJbmRleCA9IGNvbnRlbnQubGVuZ3RoO1xyXG4gICAgICAgICAgICBpZiAoZW5kSW5kZXggIT09IC0xICYmIChuZXh0TWVudGlvbkluZGV4ID09PSAtMSB8fCBlbmRJbmRleCA8IG5leHRNZW50aW9uSW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICBibG9ja0VuZEluZGV4ID0gZW5kSW5kZXg7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV4dE1lbnRpb25JbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGJsb2NrRW5kSW5kZXggPSBuZXh0TWVudGlvbkluZGV4O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBib3VuZGFyaWVzLnB1c2goeyBzdGFydDogbGluZVN0YXJ0SW5kZXgsIGVuZDogYmxvY2tFbmRJbmRleCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBib3VuZGFyaWVzO1xyXG4gICAgfVxyXG59XHJcbiIsICJpbXBvcnQgeyBCbG9ja0JvdW5kYXJ5U3RyYXRlZ3kgfSBmcm9tICcuL0Jsb2NrQm91bmRhcnlTdHJhdGVneSc7XHJcblxyXG5leHBvcnQgY2xhc3MgU2luZ2xlTGluZUJsb2NrQm91bmRhcnlTdHJhdGVneSBpbXBsZW1lbnRzIEJsb2NrQm91bmRhcnlTdHJhdGVneSB7XHJcbiAgICBmaW5kQmxvY2tCb3VuZGFyaWVzKGNvbnRlbnQ6IHN0cmluZywgY3VycmVudE5vdGVOYW1lOiBzdHJpbmcpOiB7IHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyIH1bXSB7XHJcbiAgICAgICAgY29uc3QgYm91bmRhcmllczogeyBzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlciB9W10gPSBbXTtcclxuICAgICAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgICAgICBpZiAobGluZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdExpbmUgPSBsaW5lc1swXTtcclxuICAgICAgICAgICAgYm91bmRhcmllcy5wdXNoKHsgc3RhcnQ6IDAsIGVuZDogZmlyc3RMaW5lLmxlbmd0aCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBib3VuZGFyaWVzO1xyXG4gICAgfVxyXG59XHJcbiIsICJpbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IFNldHRpbmdzTWFuYWdlciB9IGZyb20gJy4vU2V0dGluZ3NNYW5hZ2VyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2FsZXNjZVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIGFwcDogQXBwLFxyXG4gICAgICAgIHByaXZhdGUgcGx1Z2luOiBhbnksXHJcbiAgICAgICAgcHJpdmF0ZSBzZXR0aW5nc01hbmFnZXI6IFNldHRpbmdzTWFuYWdlclxyXG4gICAgKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1Nob3cgaW4gRGFpbHkgTm90ZXMnKVxyXG4gICAgICAgICAgICAuc2V0RGVzYygnRW5hYmxlIENvYWxlc2NlIHZpZXcgaW4gZGFpbHkgbm90ZXMnKVxyXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcclxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5zaG93SW5EYWlseU5vdGVzKVxyXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldHRpbmdzLnNob3dJbkRhaWx5Tm90ZXMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgIH1cclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQW1DOzs7QUNRbkMsSUFBTSxtQkFBMkM7QUFBQSxFQUM3QyxXQUFXO0FBQUEsRUFDWCxnQkFBZ0I7QUFBQSxFQUNoQixpQkFBaUI7QUFBQSxFQUNqQixrQkFBa0I7QUFBQSxFQUNsQix1QkFBdUI7QUFDM0I7QUFnQk8sSUFBTSxrQkFBTixNQUFzQjtBQUFBLEVBSXpCLFlBQVksUUFBZ0I7QUFDeEIsU0FBSyxTQUFTO0FBQUEsRUFDbEI7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNqQixTQUFLLFdBQVcsT0FBTyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsTUFBTSxLQUFLLE9BQU8sU0FBUyxDQUFDO0FBQUEsRUFDcEY7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNqQixVQUFNLEtBQUssT0FBTyxTQUFTLEtBQUssUUFBUTtBQUFBLEVBQzVDO0FBQ0o7OztBQzdDQSxJQUFBQyxtQkFBeUM7OztBQ0F6QyxJQUFBQyxtQkFBc0Q7OztBQ0F0RCxzQkFBK0M7OztBQ0F4QyxJQUFNLFVBQU4sTUFBYTtBQUFBLEVBR2hCLE9BQU8sU0FBUztBQUNaLFlBQU8sVUFBVTtBQUFBLEVBQ3JCO0FBQUEsRUFFQSxPQUFPLFVBQVU7QUFDYixZQUFPLFVBQVU7QUFBQSxFQUNyQjtBQUFBLEVBRUEsS0FBSyxZQUFrQixnQkFBdUI7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QU87QUFDekIsU0FBSyxrQkFBa0IsSUFBSSxnQkFBZ0IsSUFBSTtBQUMvQyxVQUFNLEtBQUssZ0JBQWdCLGFBQWE7QUFFeEMsU0FBSyxjQUFjLElBQUksbUJBQW1CLEtBQUssS0FBSyxNQUFNLEtBQUssZUFBZSxDQUFDO0FBRS9FLFNBQUssa0JBQWtCLElBQUksZ0JBQWdCLEtBQUssS0FBSyxLQUFLLGVBQWU7QUFDekUsU0FBSyxJQUFJLFVBQVUsR0FBRyxhQUFhLENBQUMsU0FBZ0I7QUFDbkQsVUFBSSxDQUFDO0FBQU07QUFFWCxZQUFNLFVBQVUsS0FBSyxZQUFZLElBQUk7QUFDckMsVUFBSSxDQUFDLFdBQVksV0FBVyxLQUFLLGdCQUFnQixTQUFTLGtCQUFtQjtBQUM1RSxhQUFLLGdCQUFnQixlQUFlLElBQUk7QUFBQSxNQUN6QyxPQUFPO0FBQ04sYUFBSyxnQkFBZ0IsZUFBZTtBQUFBLE1BQ3JDO0FBQUEsSUFDRCxDQUFDO0FBUUQsSUFBQyxPQUFlLGdCQUFnQixXQUFXO0FBQzFDLGFBQU8sT0FBTztBQUNkLGNBQVEsSUFBSSxpQkFBaUI7QUFBQSxJQUM5QjtBQUNBLElBQUMsT0FBZSxpQkFBaUIsV0FBVztBQUMzQyxhQUFPLFFBQVE7QUFDZixjQUFRLElBQUksa0JBQWtCO0FBQUEsSUFDL0I7QUFBQSxFQUNEO0FBQUEsRUFFQSxXQUFXO0FBQ1YsU0FBSyxnQkFBZ0IsZUFBZTtBQUFBLEVBQ3JDO0FBQUEsRUFFUSxZQUFZLE1BQXNCO0FBRXpDLFVBQU0sbUJBQW9CLEtBQUssSUFBWSxnQkFBZ0IsUUFBUSxhQUFhO0FBQ2hGLFFBQUksQ0FBQyxvQkFBb0IsQ0FBQyxpQkFBaUIsU0FBUztBQUNuRCxXQUFLLE9BQU8sTUFBTSxvQ0FBb0M7QUFDdEQsYUFBTztBQUFBLElBQ1I7QUFHQSxVQUFNLG1CQUFtQixpQkFBaUIsU0FBUyxRQUFRLFVBQVU7QUFDckUsUUFBSSxDQUFDLGtCQUFrQjtBQUN0QixXQUFLLE9BQU8sTUFBTSwrQ0FBK0M7QUFBQSxJQUNsRTtBQUVBLFVBQU0sbUJBQW1CO0FBR3pCLFFBQUksQ0FBQyxLQUFLLEtBQUssV0FBVyxnQkFBZ0IsR0FBRztBQUM1QyxhQUFPO0FBQUEsSUFDUjtBQUdBLFdBQU8saUJBQWlCLEtBQUssS0FBSyxJQUFJO0FBQUEsRUFDdkM7QUFDRDsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
